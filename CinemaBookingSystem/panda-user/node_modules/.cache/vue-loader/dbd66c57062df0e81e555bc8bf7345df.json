{"remainingRequest":"D:\\javaProjects\\pqq\\CinemaBookingSystem\\panda-user\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\javaProjects\\pqq\\CinemaBookingSystem\\panda-user\\src\\views\\user\\UserInfo.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\javaProjects\\pqq\\CinemaBookingSystem\\panda-user\\src\\views\\user\\UserInfo.vue","mtime":1715002116196},{"path":"D:\\javaProjects\\pqq\\CinemaBookingSystem\\panda-user\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1715002107957},{"path":"D:\\javaProjects\\pqq\\CinemaBookingSystem\\panda-user\\node_modules\\babel-loader\\lib\\index.js","mtime":1715002107113},{"path":"D:\\javaProjects\\pqq\\CinemaBookingSystem\\panda-user\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1715002107957},{"path":"D:\\javaProjects\\pqq\\CinemaBookingSystem\\panda-user\\node_modules\\vue-loader\\lib\\index.js","mtime":1715002115483}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICJVc2VySW5mbyIsDQogIGRhdGEoKSB7DQogICAgbGV0IGNoZWNrRW1haWwgPSAocnVsZSwgdmFsdWUsIGNiKSA9PiB7DQogICAgICBjb25zdCByZWdFbWFpbCA9IC9eKFthLXpBLVowLTlfLV0pK0AoW2EtekEtWjAtOV8tXSkrKFwuW2EtekEtWjAtOV8tXSkrLw0KICAgICAgaWYgKHJlZ0VtYWlsLnRlc3QodmFsdWUpKXsNCiAgICAgICAgcmV0dXJuIGNiKCkNCiAgICAgIH0NCiAgICAgIGNiKG5ldyBFcnJvcign6K+36L6T5YWl5ZCI5rOV55qE6YKu566xJykpDQogICAgfQ0KICAgIGxldCBjaGVja01vYmlsZSA9IChydWxlLCB2YWx1ZSwgY2IpID0+IHsNCiAgICAgIGNvbnN0IHJlZ01vYmlsZSA9IC9eKDB8ODZ8MTc5NTEpPygxM1swLTldfDE1WzAxMjM0NTY3ODldfDE3WzY3OF18MThbMC05XXwxNFs1N10pWzAtOV17OH0kLw0KICAgICAgaWYgKHJlZ01vYmlsZS50ZXN0KHZhbHVlKSl7DQogICAgICAgIHJldHVybiBjYigpDQogICAgICB9DQogICAgICBjYihuZXcgRXJyb3IoJ+ivt+i+k+WFpeWQiOazleeahOaJi+acuuWPt+eggScpKQ0KICAgIH0NCiAgICByZXR1cm4gew0KICAgICAgcGljRGlhbG9nOmZhbHNlLA0KICAgICAgbG9naW5Vc2VyOnt9LA0KICAgICAgcGljczpbXSwNCiAgICAgIHBpY3R1cmVMaXN0OltdLA0KICAgICAgcGljU3JjOiIiLA0KICAgICAgZGVsZXRlUGljTGlzdDpbXSwNCg0KICAgICAgLy/pqozor4HooajljZXop4TliJnlr7nosaENCiAgICAgIGxvZ2luVXNlclJ1bGVzOiB7DQogICAgICAgIHVzZXJOYW1lOiBbDQogICAgICAgICAgeyByZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogJ+ivt+i+k+WFpeeUqOaIt+WQjScsIHRyaWdnZXI6ICdibHVyJyB9DQogICAgICAgIF0sDQogICAgICAgIGVtYWlsOiBbDQogICAgICAgICAgeyByZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogJ+ivt+i+k+WFpeeUteWtkOmCrueusScsIHRyaWdnZXI6ICdibHVyJyB9LA0KICAgICAgICAgIHsgdmFsaWRhdG9yOiBjaGVja0VtYWlsLCB0cmlnZ2VyOiAnYmx1cid9DQogICAgICAgIF0sDQogICAgICAgIHBob25lTnVtYmVyOiBbDQogICAgICAgICAgeyByZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogJ+ivt+i+k+WFpeaJi+acuuWPt+eggScsIHRyaWdnZXI6ICdibHVyJyB9LA0KICAgICAgICAgIHsgdmFsaWRhdG9yOiBjaGVja01vYmlsZSwgdHJpZ2dlcjogJ2JsdXInfQ0KICAgICAgICBdLA0KICAgICAgICBzZXg6IFsNCiAgICAgICAgICB7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAn6K+36YCJ5oup5oCn5YirJywgdHJpZ2dlcjogJ2NoYW5nZScgfQ0KICAgICAgICBdLA0KICAgICAgICBiaXJ0aGRheTogWw0KICAgICAgICAgIHsgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICfor7fpgInmi6nnlJ/ml6UnLCB0cmlnZ2VyOiAnY2hhbmdlJyB9DQogICAgICAgIF0NCiAgICAgIH0NCiAgICB9DQogIH0sDQogIGNyZWF0ZWQoKSB7DQogICAgdGhpcy5nZXRVc2VyKCkNCiAgfSwNCiAgbWV0aG9kczp7DQogICAgYXN5bmMgZ2V0VXNlcigpew0KICAgICAgY29uc3QgeyBkYXRhIDogcmVzIH0gPSBhd2FpdCBheGlvcy5nZXQoJ3N5c1VzZXIvJytKU09OLnBhcnNlKHdpbmRvdy5zZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdsb2dpblVzZXInKSkudXNlcklkKQ0KICAgICAgdGhpcy5sb2dpblVzZXIgPSByZXMuZGF0YQ0KICAgICAgdGhpcy5waWNzLnB1c2goe25hbWU6J3BpY3R1cmUnLHVybDpKU09OLnBhcnNlKHRoaXMubG9naW5Vc2VyLnVzZXJQaWN0dXJlKVswXX0pDQogICAgfSwNCiAgICBhc3luYyBoYW5kbGVTdWNjZXNzKHJlc3BvbnNlLCBmaWxlLCBmaWxlTGlzdCl7DQogICAgICB0aGlzLnBpY3MgPSBmaWxlTGlzdA0KICAgICAgY29uc29sZS5sb2codGhpcy5waWNzKQ0KICAgICAgYXdhaXQgdGhpcy5zdWJtaXRGaWxlKCkNCiAgICAgIHRoaXMucGljU3JjID0gdGhpcy5waWN0dXJlTGlzdFswXQ0KICAgIH0sDQogICAgaGFuZGxlRXJyb3IoZXJyKXsNCiAgICAgIGNvbnNvbGUubG9nKGVycikNCiAgICB9LA0KICAgIGhhbmRsZUNoYW5nZShmaWxlLCBmaWxlbGlzdCl7DQogICAgICB0aGlzLnBpY3MgPSBmaWxlbGlzdC5zbGljZSgwKQ0KICAgICAgY29uc29sZS5sb2coMTExKQ0KICAgICAgY29uc29sZS5sb2codGhpcy5waWNzKQ0KICAgICAgdGhpcy5waWNEaWFsb2cgPXRydWUNCiAgICB9LA0KICAgIGhhbmRsZVJlbW92ZShmaWxlKSB7DQogICAgICBjb25zdCBmaWxlUGF0aCA9IGZpbGUudXJsDQogICAgICBjb25zb2xlLmxvZyhmaWxlUGF0aCkNCiAgICAgIGNvbnN0IGlkeCA9IHRoaXMucGljcy5maW5kSW5kZXgoeCA9PiB4LnVybCA9PT0gZmlsZVBhdGgpDQogICAgICBpZihmaWxlLnN0YXR1cyA9PT0gJ3N1Y2Nlc3MnKXsNCiAgICAgICAgdGhpcy5kZWxldGVQaWNMaXN0LnB1c2goZmlsZS51cmwpDQogICAgICB9DQogICAgICB0aGlzLnBpY3Muc3BsaWNlKGlkeCwgMSkNCiAgICB9LA0KICAgICBhc3luYyBlZGl0VXNlcigpew0KICAgICAgIGF3YWl0IHRoaXMuc3VibWl0RmlsZSgpDQogICAgICAgdGhpcy5sb2dpblVzZXIudXNlclBpY3R1cmUgPSBKU09OLnN0cmluZ2lmeSh0aGlzLnBpY3R1cmVMaXN0KQ0KICAgICAgIGNvbnN0IF90aGlzID0gdGhpcw0KICAgICAgIGxldCBzdWNjZXNzID0gdHJ1ZQ0KICAgICAgIGF4aW9zLmRlZmF1bHRzLmhlYWRlcnMucHV0WydDb250ZW50LVR5cGUnXSA9ICdhcHBsaWNhdGlvbi9qc29uJw0KICAgICAgIGF3YWl0IGF4aW9zLnB1dCgnc3lzVXNlcicsSlNPTi5zdHJpbmdpZnkodGhpcy5sb2dpblVzZXIpKS50aGVuKHJlc3A9PnsNCiAgICAgICAgIGlmIChyZXNwLmRhdGEuY29kZSAhPT0gMjAwKXsNCiAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcign5L+u5pS555So5oi35L+h5oGv5aSx6LSl77yBJykNCiAgICAgICAgICAgc3VjY2VzcyA9IGZhbHNlDQogICAgICAgICB9DQogICAgICAgfSkNCiAgICAgICBpZighc3VjY2VzcykgcmV0dXJuDQogICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCfkv67mlLnnlKjmiLfkv6Hmga/miJDlip8hJykNCiAgICAgICB0aGlzLnBpY3MgPSBbXQ0KICAgICAgIHRoaXMucGljdHVyZUxpc3QgPSBbXQ0KICAgICAgIGF3YWl0IHRoaXMuZ2V0VXNlcigpDQogICAgICAgdGhpcy5waWNEaWFsb2cgPSBmYWxzZQ0KICAgIH0sDQogICAgYXN5bmMgc3VibWl0RmlsZSgpew0KICAgICAgY29uc3QgX3RoaXMgPSB0aGlzDQogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGljcy5sZW5ndGg7IGkrKyl7DQogICAgICAgIGxldCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpDQogICAgICAgIGlmICh0aGlzLnBpY3NbaV0uc3RhdHVzID09PSAnc3VjY2VzcycpIHsNCiAgICAgICAgICBsZXQgcyA9IHRoaXMucGljc1tpXS51cmwNCiAgICAgICAgICB0aGlzLnBpY3R1cmVMaXN0LnB1c2gocy5zdWJzdHJpbmcocy5pbmRleE9mKCcvaW1hZ2VzJykpKQ0KICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgIH0NCiAgICAgICAgbGV0IGZpbGUgPSB0aGlzLnBpY3NbaV0ucmF3DQogICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnZmlsZScsIGZpbGUpDQogICAgICAgIGF3YWl0IGF4aW9zLnBvc3QoJ3VwbG9hZC91c2VyJywgZm9ybURhdGEpLnRoZW4ocmVzcG9uc2UgPT57DQogICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpDQogICAgICAgICAgX3RoaXMucGljdHVyZUxpc3QucHVzaChyZXNwb25zZS5kYXRhLmRhdGEpDQogICAgICAgIH0pDQogICAgICB9DQogICAgfSwNCiAgICBoYW5kbGVFeGNlZWQoKXsNCiAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoIueUqOaIt+WktOWDj+acgOWkmuS4iuS8oOS4gOW8oO+8gSIpDQogICAgfSwNCiAgfQ0KfQ0K"},{"version":3,"sources":["UserInfo.vue"],"names":[],"mappings":";AA0DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"UserInfo.vue","sourceRoot":"src/views/user","sourcesContent":["<template>\r\n<div class=\"user-info-container\">\r\n  <div style=\"width: 30%\">\r\n    <h1>用户头像</h1>\r\n    <el-upload action=\"\"\r\n               list-type=\"picture-card\"\r\n               :auto-upload=\"false\"\r\n               :limit=\"1\"\r\n               :file-list=\"pics\"\r\n               :on-change=\"handleChange\"\r\n               :on-success=\"handleSuccess\"\r\n               :on-error=\"handleError\"\r\n               :on-exceed=\"handleExceed\"\r\n               ref=\"pictureRef\"\r\n               :http-request=\"submitFile\">\r\n      <i slot=\"default\" class=\"el-icon-plus\"></i>\r\n      <div slot=\"file\" slot-scope=\"{file}\">\r\n        <img class=\"el-upload-list__item-thumbnail\" :src=\"(picDialog? '' : global.base)+file.url\" alt=\"\">\r\n        <span class=\"el-upload-list__item-actions\">\r\n          <span class=\"el-upload-list__item-delete\" @click=\"handleRemove(file)\">\r\n            <i class=\"el-icon-delete\"></i>\r\n          </span>\r\n        </span>\r\n      </div>\r\n    </el-upload>\r\n  </div>\r\n  <div style=\"width: 70%\">\r\n    <el-form :model=\"loginUser\"  :rules=\"loginUserRules\" ref=\"editFormRef\" label-width=\"80px\">\r\n      <el-form-item label=\"用户名\" prop=\"userName\">\r\n        <el-input v-model=\"loginUser.userName\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"电子邮箱\" prop=\"email\">\r\n        <el-input v-model=\"loginUser.email\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"手机号码\" prop=\"phoneNumber\">\r\n        <el-input v-model=\"loginUser.phoneNumber\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"性别\" prop=\"sex\">\r\n          <el-radio v-model=\"loginUser.sex\" :label=\"true\">男</el-radio>\r\n          <el-radio v-model=\"loginUser.sex\" :label=\"false\">女</el-radio>\r\n      </el-form-item>\r\n      <el-form-item label=\"生日\" prop=\"birthday\">\r\n        <el-date-picker\r\n            v-model=\"loginUser.birthday\"\r\n            value-format=\"yyyy-MM-dd\"\r\n            type=\"date\"\r\n            placeholder=\"选择日期\"></el-date-picker>\r\n      </el-form-item>\r\n      <el-form-item label=\"个性签名\" prop=\"autograph\">\r\n        <el-input v-model=\"loginUser.autograph\"></el-input>\r\n      </el-form-item>\r\n        <el-button type=\"primary\" @click=\"editUser\">保存</el-button>\r\n    </el-form>\r\n  </div>\r\n</div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"UserInfo\",\r\n  data() {\r\n    let checkEmail = (rule, value, cb) => {\r\n      const regEmail = /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\\.[a-zA-Z0-9_-])+/\r\n      if (regEmail.test(value)){\r\n        return cb()\r\n      }\r\n      cb(new Error('请输入合法的邮箱'))\r\n    }\r\n    let checkMobile = (rule, value, cb) => {\r\n      const regMobile = /^(0|86|17951)?(13[0-9]|15[0123456789]|17[678]|18[0-9]|14[57])[0-9]{8}$/\r\n      if (regMobile.test(value)){\r\n        return cb()\r\n      }\r\n      cb(new Error('请输入合法的手机号码'))\r\n    }\r\n    return {\r\n      picDialog:false,\r\n      loginUser:{},\r\n      pics:[],\r\n      pictureList:[],\r\n      picSrc:\"\",\r\n      deletePicList:[],\r\n\r\n      //验证表单规则对象\r\n      loginUserRules: {\r\n        userName: [\r\n          { required: true, message: '请输入用户名', trigger: 'blur' }\r\n        ],\r\n        email: [\r\n          { required: true, message: '请输入电子邮箱', trigger: 'blur' },\r\n          { validator: checkEmail, trigger: 'blur'}\r\n        ],\r\n        phoneNumber: [\r\n          { required: true, message: '请输入手机号码', trigger: 'blur' },\r\n          { validator: checkMobile, trigger: 'blur'}\r\n        ],\r\n        sex: [\r\n          { required: true, message: '请选择性别', trigger: 'change' }\r\n        ],\r\n        birthday: [\r\n          { required: true, message: '请选择生日', trigger: 'change' }\r\n        ]\r\n      }\r\n    }\r\n  },\r\n  created() {\r\n    this.getUser()\r\n  },\r\n  methods:{\r\n    async getUser(){\r\n      const { data : res } = await axios.get('sysUser/'+JSON.parse(window.sessionStorage.getItem('loginUser')).userId)\r\n      this.loginUser = res.data\r\n      this.pics.push({name:'picture',url:JSON.parse(this.loginUser.userPicture)[0]})\r\n    },\r\n    async handleSuccess(response, file, fileList){\r\n      this.pics = fileList\r\n      console.log(this.pics)\r\n      await this.submitFile()\r\n      this.picSrc = this.pictureList[0]\r\n    },\r\n    handleError(err){\r\n      console.log(err)\r\n    },\r\n    handleChange(file, filelist){\r\n      this.pics = filelist.slice(0)\r\n      console.log(111)\r\n      console.log(this.pics)\r\n      this.picDialog =true\r\n    },\r\n    handleRemove(file) {\r\n      const filePath = file.url\r\n      console.log(filePath)\r\n      const idx = this.pics.findIndex(x => x.url === filePath)\r\n      if(file.status === 'success'){\r\n        this.deletePicList.push(file.url)\r\n      }\r\n      this.pics.splice(idx, 1)\r\n    },\r\n     async editUser(){\r\n       await this.submitFile()\r\n       this.loginUser.userPicture = JSON.stringify(this.pictureList)\r\n       const _this = this\r\n       let success = true\r\n       axios.defaults.headers.put['Content-Type'] = 'application/json'\r\n       await axios.put('sysUser',JSON.stringify(this.loginUser)).then(resp=>{\r\n         if (resp.data.code !== 200){\r\n           this.$message.error('修改用户信息失败！')\r\n           success = false\r\n         }\r\n       })\r\n       if(!success) return\r\n       this.$message.success('修改用户信息成功!')\r\n       this.pics = []\r\n       this.pictureList = []\r\n       await this.getUser()\r\n       this.picDialog = false\r\n    },\r\n    async submitFile(){\r\n      const _this = this\r\n      for (let i = 0; i < this.pics.length; i++){\r\n        let formData = new FormData()\r\n        if (this.pics[i].status === 'success') {\r\n          let s = this.pics[i].url\r\n          this.pictureList.push(s.substring(s.indexOf('/images')))\r\n          continue\r\n        }\r\n        let file = this.pics[i].raw\r\n        formData.append('file', file)\r\n        await axios.post('upload/user', formData).then(response =>{\r\n          console.log(response)\r\n          _this.pictureList.push(response.data.data)\r\n        })\r\n      }\r\n    },\r\n    handleExceed(){\r\n      this.$message.error(\"用户头像最多上传一张！\")\r\n    },\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.user-info-container{\r\n  display: flex;\r\n}\r\n</style>\r\n"]}]}