{"remainingRequest":"E:\\大学课设做过的项目\\软件开发综合实践大项目\\Schoolticket\\pqq\\CinemaBookingSystem\\panda-user\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\大学课设做过的项目\\软件开发综合实践大项目\\Schoolticket\\pqq\\CinemaBookingSystem\\panda-user\\src\\views\\pay\\BillDetail.vue?vue&type=script&lang=js","dependencies":[{"path":"E:\\大学课设做过的项目\\软件开发综合实践大项目\\Schoolticket\\pqq\\CinemaBookingSystem\\panda-user\\src\\views\\pay\\BillDetail.vue","mtime":1714355098000},{"path":"E:\\大学课设做过的项目\\软件开发综合实践大项目\\Schoolticket\\pqq\\CinemaBookingSystem\\panda-user\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1714355044000},{"path":"E:\\大学课设做过的项目\\软件开发综合实践大项目\\Schoolticket\\pqq\\CinemaBookingSystem\\panda-user\\node_modules\\babel-loader\\lib\\index.js","mtime":1714355038000},{"path":"E:\\大学课设做过的项目\\软件开发综合实践大项目\\Schoolticket\\pqq\\CinemaBookingSystem\\panda-user\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1714355044000},{"path":"E:\\大学课设做过的项目\\软件开发综合实践大项目\\Schoolticket\\pqq\\CinemaBookingSystem\\panda-user\\node_modules\\vue-loader\\lib\\index.js","mtime":1714355092000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCcNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogIkJpbGxEZXRhaWwiLA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICBiaWxsSWQ6IHRoaXMuJHJvdXRlLnBhcmFtcy5iaWxsSWQsDQogICAgICBiaWxsSW5mbzogew0KICAgICAgICBzeXNTZXNzaW9uOiB7DQogICAgICAgICAgc3lzTW92aWU6IHt9LA0KICAgICAgICAgIHN5c0hhbGw6IHsNCiAgICAgICAgICAgIHN5c0NpbmVtYTogew0KICAgICAgICAgICAgICB1c2VyOiB7fQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSwNCiAgICAgIGJpbGxTZWF0czogW10sDQogICAgICBwYXlTdGF0ZTogbnVsbCwNCiAgICAgIGNhbmNlbFN0YXRlOiBudWxsLA0KICAgICAgY2FuY2VsVGltZTogbnVsbCwNCiAgICAgIC8v6K6h5pe2DQogICAgICBtaW51dGVzOiAxLA0KICAgICAgc2Vjb25kczogMCwNCiAgICB9DQogIH0sDQogIGNyZWF0ZWQoKSB7DQogICAgdGhpcy5nZXRCaWxsSW5mbygpDQogIH0sDQogIG1vdW50ZWQoKSB7DQogICAgdGhpcy5hZGQoKQ0KICB9LA0KICBtZXRob2RzOiB7DQogICAgYXN5bmMgZ2V0QmlsbEluZm8oKSB7DQogICAgICBjb25zdCB7IGRhdGEgOiByZXMgfSA9IGF3YWl0IGF4aW9zLmdldCgnc3lzQmlsbC8nICsgdGhpcy5iaWxsSWQpDQogICAgICBpZihyZXMuY29kZSAhPT0gMjAwKSByZXR1cm4gdGhpcy4kbWVzc2FnZS5lcnJvcign6I635Y+W5L+h5oGv5aSx6LSlJykNCiAgICAgIGxldCB1c2VySWQgPSBKU09OLnBhcnNlKHdpbmRvdy5zZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdsb2dpblVzZXInKSkudXNlcklkDQogICAgICBpZiAodXNlcklkICE9PSByZXMuZGF0YS51c2VySWQpIHsNCiAgICAgICAgdGhpcy4kYWxlcnQoJ+mdnuazleaTjeS9nO+8geaTjeS9nOmdnuacrOS6uuiuouWNleOAgicsICfpnZ7ms5Xmk43kvZzorqLljZXorablkYonLCB7DQogICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICfmiJHnn6XpgZPkuoYnLA0KICAgICAgICAgIGNhbGxiYWNrOiBhY3Rpb24gPT4gew0KICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goJy9iaWxsJykNCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICAgIHJldHVybg0KICAgICAgfQ0KICAgICAgdGhpcy5iaWxsSW5mbyA9IHJlcy5kYXRhDQoNCiAgICAgIHRoaXMuY2FuY2VsVGltZSA9IHRoaXMuYmlsbEluZm8uY2FuY2VsVGltZQ0KICAgICAgY29uc29sZS5sb2codGhpcy5iaWxsSW5mbykNCiAgICAgIC8vIOaIquatouaXtumXtA0KICAgICAgY29uc29sZS5sb2codGhpcy5iaWxsSW5mby5kZWFkbGluZSkNCiAgICAgIC8v5aSE55CG6K6i5Y2V5bqn5L2N5L+h5oGvDQogICAgICB0aGlzLmJpbGxTZWF0cyA9IEpTT04ucGFyc2UodGhpcy5iaWxsSW5mby5zZWF0cykNCiAgICAgIHRoaXMucGF5U3RhdGUgPSB0aGlzLmJpbGxJbmZvLnBheVN0YXRlDQogICAgICB0aGlzLmNhbmNlbFN0YXRlID0gdGhpcy5iaWxsSW5mby5jYW5jZWxTdGF0ZQ0KICAgICAgY29uc29sZS5sb2coJ3RoZSBjcmVhdGVfdGltZScrdGhpcy5iaWxsSW5mby5jcmVhdGVUaW1lKQ0KICAgICAgdGhpcy5jb21wdXRlTGVmdFRpbWUoKQ0KICAgIH0sDQogICAgYXN5bmMgcGF5Rm9yQmlsbCgpIHsNCiAgICAgIC8v5pu05paw6K6i5Y2V54q25oCBDQogICAgICB0aGlzLmJpbGxJbmZvLnBheVN0YXRlID0gdHJ1ZQ0KICAgICAgLy/mm7TmlrDorqLljZXkv6Hmga/lkozlnLrmrKHluqfkvY3kv6Hmga8NCiAgICAgIGF4aW9zLmRlZmF1bHRzLmhlYWRlcnMucHV0WydDb250ZW50LVR5cGUnXSA9ICdhcHBsaWNhdGlvbi9qc29uJw0KICAgICAgY29uc3QgeyBkYXRhOiByZXN9ID0gYXdhaXQgYXhpb3MucHV0KCdzeXNCaWxsJywgSlNPTi5zdHJpbmdpZnkodGhpcy5iaWxsSW5mbykpDQogICAgICBpZihyZXMuY29kZSAhPT0gMjAwKSByZXR1cm4gdGhpcy4kbWVzc2FnZS5lcnJvcign5pSv5LuY5aSx6LSlJykNCiAgICAgIHRoaXMucGF5U3RhdGUgPSB0cnVlDQogICAgICB0aGlzLiRhbGVydCgn5pSv5LuY5oiQ5Yqf77yB5oKo5Y+v5Lul5YmN5b6A5Liq5Lq65Lit5b+D5p+l55yL6K6i5Y2V5L+h5oGvJywgJ+aUr+S7mOmAmuefpScsIHsNCiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICfmiJHnn6XpgZPkuoYnLA0KICAgICAgICBjYWxsYmFjazogYWN0aW9uID0+IHsNCiAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCgnL2JpbGwnKQ0KICAgICAgICB9DQogICAgICB9KQ0KICAgIH0sDQogICAgYXN5bmMgY2FuY2VsRm9yQmlsbCgpIHsNCiAgICAgIC8v5pu05paw6K6i5Y2V54q25oCBDQogICAgICB0aGlzLmJpbGxJbmZvLmNhbmNlbFN0YXRlID0gdHJ1ZQ0KICAgICAgdGhpcy5iaWxsSW5mby5jYW5jZWxUaW1lID0gbW9tZW50KG5ldyBEYXRlKCkpLmZvcm1hdCgnWVlZWS1NTS1ERCBISDptbTpzcycpDQogICAgICAvLyDojrflj5blnLrmrKHluqfkvY3kv6Hmga8NCiAgICAgIGNvbnN0IHsgZGF0YSA6IGN1clNlc3Npb24gfSA9IGF3YWl0IGF4aW9zLmdldCgnc3lzU2Vzc2lvbi9maW5kLycgKyB0aGlzLmJpbGxJbmZvLnNlc3Npb25JZCkNCiAgICAgIGxldCBzZXNzaW9uU2VhdHMgPSBKU09OLnBhcnNlKGN1clNlc3Npb24uZGF0YS5zZXNzaW9uU2VhdHMpDQogICAgICAvLyDop6PmnpDlh7rorqLljZXpgInmi6nnmoTluqfkvY3vvIzmm7TmlrDluqfkvY3kv6Hmga8NCiAgICAgIGZvcihsZXQgc2VhdCBvZiB0aGlzLmJpbGxTZWF0cyl7DQogICAgICAgIGxldCByb3cgPSBzZWF0LnN1YnN0cmluZygwLCBzZWF0LmluZGV4T2YoJ+aOkicpKQ0KICAgICAgICBsZXQgY29sID0gTnVtYmVyLnBhcnNlSW50KHNlYXQuc3Vic3RyaW5nKHNlYXQuaW5kZXhPZign5o6SJykgKyAxLCBzZWF0Lmxlbmd0aCAtIDEpKQ0KICAgICAgICBzZXNzaW9uU2VhdHNbcm93XVtjb2wgLSAxXSA9IDANCiAgICAgIH0NCiAgICAgIC8vIOabtOaWsOiuouWNleS/oeaBr+WSjOWcuuasoeW6p+S9jeS/oeaBrw0KICAgICAgYXhpb3MuZGVmYXVsdHMuaGVhZGVycy5wdXRbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL2pzb24nDQogICAgICBjb25zdCB7IGRhdGE6IHJlcyB9ID0gYXdhaXQgYXhpb3MucHV0KCdzeXNCaWxsL2NhbmNlbCcsSlNPTi5zdHJpbmdpZnkoe3N5c0JpbGw6IHRoaXMuYmlsbEluZm8sIHNlc3Npb25TZWF0czogSlNPTi5zdHJpbmdpZnkoc2Vzc2lvblNlYXRzKX0pKQ0KICAgICAgaWYocmVzLmNvZGUgIT09IDIwMCkgcmV0dXJuIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+WPlua2iOWksei0pScpDQoNCiAgICAgIHRoaXMucGF5U3RhdGUgPSBmYWxzZQ0KICAgICAgdGhpcy5jYW5jZWxTdGF0ZSA9IHRydWUNCiAgICAgIHRoaXMuJGFsZXJ0KCflj5bmtojmiJDlip/vvIHmgqjlj6/ku6XliY3lvoDkuKrkurrkuK3lv4Pmn6XnnIvorqLljZXkv6Hmga8nLCAn5Y+W5raI6YCa55+lJywgew0KICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ+aIkeefpemBk+S6hicsDQogICAgICAgIGNhbGxiYWNrOiBhY3Rpb24gPT4gew0KICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKCcvYmlsbERldGFpbC8nICsgdGhpcy5iaWxsSW5mby5iaWxsSWQpDQogICAgICAgIH0NCiAgICAgIH0pDQogICAgfSwNCiAgICBjb21wdXRlTGVmdFRpbWUoKSB7DQogICAgICBsZXQgY3VyID0gbmV3IERhdGUoKQ0KICAgICAgbGV0IGNyZWF0ZVRpbWUgPSBuZXcgRGF0ZSh0aGlzLmJpbGxJbmZvLmNyZWF0ZVRpbWUpDQogICAgICBsZXQgZGlmZiA9IDE1ICogNjAgLSAoY3VyIC0gY3JlYXRlVGltZSkgLyAxMDAwDQogICAgICBpZiAoZGlmZiA8IDApIHsNCiAgICAgICAgdGhpcy5taW51dGVzID0gMA0KICAgICAgICB0aGlzLnNlY29uZHMgPSAwDQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLm1pbnV0ZXMgPSBNYXRoLmZsb29yKGRpZmYgLyA2MCkNCiAgICAgICAgdGhpcy5zZWNvbmRzID0gTWF0aC5mbG9vcihkaWZmICUgNjApDQogICAgICB9DQogICAgfSwNCiAgICAvL+iuoeaXtui9rOaNouaVsOWtl+agvOW8jw0KICAgIG51bTogZnVuY3Rpb24gKG4pIHsNCiAgICAgIHJldHVybiBuIDwgMTAgPyAnMCcgKyBuIDogJycgKyBuDQogICAgfSwNCiAgICAvL+iuoeaXtui1sOWKqA0KICAgIGFkZDogZnVuY3Rpb24gKCkgew0KICAgICAgbGV0IF90aGlzID0gdGhpcw0KICAgICAgbGV0IHRpbWUgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgew0KICAgICAgICBpZiAoX3RoaXMuc2Vjb25kcyA9PT0gMCAmJiBfdGhpcy5taW51dGVzICE9PSAwKSB7DQogICAgICAgICAgX3RoaXMuc2Vjb25kcyA9IDU5DQogICAgICAgICAgX3RoaXMubWludXRlcyAtPSAxDQogICAgICAgIH0gZWxzZSBpZiAoX3RoaXMubWludXRlcyA9PT0gMCAmJiBfdGhpcy5zZWNvbmRzID09PSAwKSB7DQogICAgICAgICAgX3RoaXMuc2Vjb25kcyA9IDANCiAgICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbCh0aW1lKQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIF90aGlzLnNlY29uZHMgLT0gMQ0KICAgICAgICB9DQogICAgICB9LCAxMDAwKQ0KICAgIH0sDQogIH0sDQogIHdhdGNoOiB7DQogICAgc2Vjb25kOiB7DQogICAgICBoYW5kbGVyIChuZXdWYWwpIHsNCiAgICAgICAgdGhpcy5udW0obmV3VmFsKQ0KICAgICAgfQ0KICAgIH0sDQogICAgbWludXRlOiB7DQogICAgICBoYW5kbGVyIChuZXdWYWwpIHsNCiAgICAgICAgdGhpcy5udW0obmV3VmFsKQ0KICAgICAgfQ0KICAgIH0NCiAgfSwNCiAgY29tcHV0ZWQ6IHsNCiAgICBzZWNvbmQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgIHJldHVybiB0aGlzLm51bSh0aGlzLnNlY29uZHMpDQogICAgfSwNCiAgICBtaW51dGU6IGZ1bmN0aW9uICgpIHsNCiAgICAgIHJldHVybiB0aGlzLm51bSh0aGlzLm1pbnV0ZXMpDQogICAgfQ0KICB9DQp9DQo="},{"version":3,"sources":["BillDetail.vue"],"names":[],"mappings":";AAyGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"BillDetail.vue","sourceRoot":"src/views/pay","sourcesContent":["<template>\r\n  <div>\r\n    <el-steps :active=\"3\" align-center>\r\n      <el-step title=\"选择影片场次\"></el-step>\r\n      <el-step title=\"选择座位\"></el-step>\r\n      <el-step title=\"15分钟内付款\"></el-step>\r\n      <el-step title=\"影院取票观影\" status=\"wait\"></el-step>\r\n    </el-steps>\r\n    <div class=\"bill-info-container\">\r\n      <!-- 订单状态 -->\r\n      <!-- 未支付，未取消，15分钟内 -->\r\n      <div class=\"bill-info-status\" v-if=\"payState === false && cancelState === false && (minutes > 0 || seconds > 0)\">\r\n        <div class=\"pay-icon\">\r\n          <img src=\"../../assets/money.png\">\r\n        </div>\r\n        <div class=\"pay-info\">\r\n          <div class=\"pay-info-status\">待支付</div>\r\n          <div class=\"pay-info-desc\">请在<span>{{minutes}}分钟{{seconds}}秒</span>内完成支付</div>\r\n        </div>\r\n      </div>\r\n      <!-- 未支付，超时取消，15分钟 -->\r\n      <div class=\"bill-info-status invalid\" v-if=\"payState === false && cancelState === true && cancelTime === null && minutes <= 0 && seconds <= 0\">\r\n        <div class=\"pay-icon\">\r\n          <img src=\"../../assets/bill-invalid.png\">\r\n        </div>\r\n        <div class=\"pay-info\">\r\n          <div class=\"pay-info-status invalid\">由于订单超时未支付，已失效</div>\r\n        </div>\r\n      </div>\r\n      <div class=\"bill-info-status finish\" v-if=\"payState === true\">\r\n        <div class=\"pay-icon\">\r\n          <img src=\"../../assets/finish.png\">\r\n        </div>\r\n        <div class=\"pay-info\">\r\n          <div class=\"pay-info-status finish\">已完成</div>\r\n        </div>\r\n      </div>\r\n      <div class=\"bill-info-status invalid\" v-if=\"cancelState === true && cancelTime !== null\">\r\n        <div class=\"pay-icon\">\r\n          <img src=\"../../assets/bill-invalid.png\">\r\n        </div>\r\n        <div class=\"pay-info\">\r\n          <div class=\"pay-info-status invalid\">订单已取消</div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- 订单信息 -->\r\n      <div class=\"bill-info-desc\">\r\n        <div class=\"bill-info-header\">\r\n          <span>订单编号: {{billInfo.billId}}</span>\r\n          <span class=\"bill-info-helper\">\r\n            (有订单问题可拨打客服电话<div>{{billInfo.sysSession.sysHall.sysCinema.cinemaPhone}}</div>，\r\n            工作时间: {{billInfo.sysSession.sysHall.sysCinema.workStartTime}}-{{billInfo.sysSession.sysHall.sysCinema.workEndTime}})</span>\r\n        </div>\r\n\r\n        <table class=\"order-table\">\r\n          <thead>\r\n          <tr>\r\n            <th>影片</th>\r\n            <th>语言版本</th>\r\n            <th>播放时间</th>\r\n            <th>座位</th>\r\n            <th>提示信息</th>\r\n          </tr>\r\n          </thead>\r\n          <tbody>\r\n          <tr>\r\n            <td class=\"movie-name\">《{{billInfo.sysSession.sysMovie.movieName}}》</td>\r\n            <td class=\"movie-name\">{{billInfo.sysSession.languageVersion}}</td>\r\n            <td class=\"showtime\">{{billInfo.sysSession.sessionDate}} {{billInfo.sysSession.playTime}} - {{billInfo.sysSession.endTime}}</td>\r\n            <td>\r\n              <span class=\"hall\">{{billInfo.sysSession.sysHall.hallName}}</span>\r\n              <div class=\"seats\">\r\n                <span class=\"bill-seat\" v-for=\"item in billSeats\" :key=\"item\"> {{item}} </span>\r\n              </div>\r\n            </td>\r\n            <td>\r\n              <span>{{billInfo.sysSession.sessionTips}}</span>\r\n            </td>\r\n          </tr>\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n      <!-- 影院信息、提交订单 -->\r\n      <div class=\"bill-info-area\">\r\n        <div class=\"cinema-info\">\r\n          <span class=\"bill-cinema-name\">{{billInfo.sysSession.sysHall.sysCinema.cinemaName}}</span>\r\n          <div class=\"bill-cinema-info\">\r\n            <span>地址: {{billInfo.sysSession.sysHall.sysCinema.cinemaAddress}} </span>\r\n            <span>电话: {{billInfo.sysSession.sysHall.sysCinema.cinemaPhone}} </span>\r\n          </div>\r\n        </div>\r\n        <div class=\"submit-bill\">\r\n          <div>总价：<span>{{(billInfo.sysSession.sessionPrice * billSeats.length).toFixed(1)}}</span></div>\r\n          <div v-if=\"payState === false && cancelState === false && (minutes > 0 || seconds > 0)\">\r\n            <el-button @click=\"payForBill\" type=\"primary\" style=\"width: 200px; margin-top: 20px;\" round>立即支付</el-button></div>\r\n          <div v-if=\"payState === false && cancelState === false && (minutes > 0 || seconds > 0)\">\r\n            <el-button @click=\"cancelForBill\" type=\"danger\" style=\"width: 200px; margin-top: 20px;\" round>取消订单</el-button></div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport moment from 'moment'\r\nexport default {\r\n  name: \"BillDetail\",\r\n  data() {\r\n    return {\r\n      billId: this.$route.params.billId,\r\n      billInfo: {\r\n        sysSession: {\r\n          sysMovie: {},\r\n          sysHall: {\r\n            sysCinema: {\r\n              user: {}\r\n            }\r\n          }\r\n        }\r\n      },\r\n      billSeats: [],\r\n      payState: null,\r\n      cancelState: null,\r\n      cancelTime: null,\r\n      //计时\r\n      minutes: 1,\r\n      seconds: 0,\r\n    }\r\n  },\r\n  created() {\r\n    this.getBillInfo()\r\n  },\r\n  mounted() {\r\n    this.add()\r\n  },\r\n  methods: {\r\n    async getBillInfo() {\r\n      const { data : res } = await axios.get('sysBill/' + this.billId)\r\n      if(res.code !== 200) return this.$message.error('获取信息失败')\r\n      let userId = JSON.parse(window.sessionStorage.getItem('loginUser')).userId\r\n      if (userId !== res.data.userId) {\r\n        this.$alert('非法操作！操作非本人订单。', '非法操作订单警告', {\r\n          confirmButtonText: '我知道了',\r\n          callback: action => {\r\n            this.$router.push('/bill')\r\n          }\r\n        })\r\n        return\r\n      }\r\n      this.billInfo = res.data\r\n\r\n      this.cancelTime = this.billInfo.cancelTime\r\n      console.log(this.billInfo)\r\n      // 截止时间\r\n      console.log(this.billInfo.deadline)\r\n      //处理订单座位信息\r\n      this.billSeats = JSON.parse(this.billInfo.seats)\r\n      this.payState = this.billInfo.payState\r\n      this.cancelState = this.billInfo.cancelState\r\n      console.log('the create_time'+this.billInfo.createTime)\r\n      this.computeLeftTime()\r\n    },\r\n    async payForBill() {\r\n      //更新订单状态\r\n      this.billInfo.payState = true\r\n      //更新订单信息和场次座位信息\r\n      axios.defaults.headers.put['Content-Type'] = 'application/json'\r\n      const { data: res} = await axios.put('sysBill', JSON.stringify(this.billInfo))\r\n      if(res.code !== 200) return this.$message.error('支付失败')\r\n      this.payState = true\r\n      this.$alert('支付成功！您可以前往个人中心查看订单信息', '支付通知', {\r\n        confirmButtonText: '我知道了',\r\n        callback: action => {\r\n          this.$router.push('/bill')\r\n        }\r\n      })\r\n    },\r\n    async cancelForBill() {\r\n      //更新订单状态\r\n      this.billInfo.cancelState = true\r\n      this.billInfo.cancelTime = moment(new Date()).format('YYYY-MM-DD HH:mm:ss')\r\n      // 获取场次座位信息\r\n      const { data : curSession } = await axios.get('sysSession/find/' + this.billInfo.sessionId)\r\n      let sessionSeats = JSON.parse(curSession.data.sessionSeats)\r\n      // 解析出订单选择的座位，更新座位信息\r\n      for(let seat of this.billSeats){\r\n        let row = seat.substring(0, seat.indexOf('排'))\r\n        let col = Number.parseInt(seat.substring(seat.indexOf('排') + 1, seat.length - 1))\r\n        sessionSeats[row][col - 1] = 0\r\n      }\r\n      // 更新订单信息和场次座位信息\r\n      axios.defaults.headers.put['Content-Type'] = 'application/json'\r\n      const { data: res } = await axios.put('sysBill/cancel',JSON.stringify({sysBill: this.billInfo, sessionSeats: JSON.stringify(sessionSeats)}))\r\n      if(res.code !== 200) return this.$message.error('取消失败')\r\n\r\n      this.payState = false\r\n      this.cancelState = true\r\n      this.$alert('取消成功！您可以前往个人中心查看订单信息', '取消通知', {\r\n        confirmButtonText: '我知道了',\r\n        callback: action => {\r\n          this.$router.push('/billDetail/' + this.billInfo.billId)\r\n        }\r\n      })\r\n    },\r\n    computeLeftTime() {\r\n      let cur = new Date()\r\n      let createTime = new Date(this.billInfo.createTime)\r\n      let diff = 15 * 60 - (cur - createTime) / 1000\r\n      if (diff < 0) {\r\n        this.minutes = 0\r\n        this.seconds = 0\r\n      } else {\r\n        this.minutes = Math.floor(diff / 60)\r\n        this.seconds = Math.floor(diff % 60)\r\n      }\r\n    },\r\n    //计时转换数字格式\r\n    num: function (n) {\r\n      return n < 10 ? '0' + n : '' + n\r\n    },\r\n    //计时走动\r\n    add: function () {\r\n      let _this = this\r\n      let time = window.setInterval(function () {\r\n        if (_this.seconds === 0 && _this.minutes !== 0) {\r\n          _this.seconds = 59\r\n          _this.minutes -= 1\r\n        } else if (_this.minutes === 0 && _this.seconds === 0) {\r\n          _this.seconds = 0\r\n          window.clearInterval(time)\r\n        } else {\r\n          _this.seconds -= 1\r\n        }\r\n      }, 1000)\r\n    },\r\n  },\r\n  watch: {\r\n    second: {\r\n      handler (newVal) {\r\n        this.num(newVal)\r\n      }\r\n    },\r\n    minute: {\r\n      handler (newVal) {\r\n        this.num(newVal)\r\n      }\r\n    }\r\n  },\r\n  computed: {\r\n    second: function () {\r\n      return this.num(this.seconds)\r\n    },\r\n    minute: function () {\r\n      return this.num(this.minutes)\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.el-step {\r\n  margin: 40px auto;\r\n}\r\n\r\n.bill-info-container{\r\n  width: 80%;\r\n  margin: 0 auto 40px auto;\r\n}\r\n\r\n.bill-info-status{\r\n  height: 120px;\r\n  background: #FFFBF2;\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 40px;\r\n}\r\n\r\n.pay-icon{\r\n  width: 40px;\r\n  height:40px;\r\n  margin-left: 50px;\r\n}\r\n\r\n.pay-icon>img{\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.pay-info{\r\n  display: flex;\r\n  flex-direction: column;\r\n  margin-left: 20px;\r\n}\r\n\r\n.pay-info-status{\r\n  color: #FAAF00;\r\n  font-size: 24px;\r\n  font-weight: 700;\r\n}\r\n\r\n.pay-info-desc{\r\n  color: #999;\r\n  font-size: 13px;\r\n}\r\n\r\n.pay-info-desc>span{\r\n  font-size: 16px;\r\n  color: #faaf00;\r\n  margin: 5px 5px;\r\n}\r\n\r\n.bill-info-status.finish{\r\n  background: #F4FFF8;\r\n}\r\n\r\n.bill-info-status.invalid{\r\n  background: #FFE0E0;\r\n}\r\n\r\n.pay-info-status.finish{\r\n  color: #26CE61;\r\n}\r\n\r\n.pay-info-status.invalid{\r\n  color: #faaaaa;\r\n}\r\n\r\n.bill-info-header{\r\n  display: flex;\r\n  justify-content: space-between;\r\n}\r\n\r\n.bill-info-header>span>div{\r\n  color: #f03d37;\r\n}\r\n\r\n.bill-info-helper{\r\n  color: #999;\r\n  font-size: 13px;\r\n  display: flex;\r\n  margin-bottom: 8px;\r\n}\r\n\r\n.order-table{\r\n  width: 100%;\r\n  border: 1px solid #e5e5e5;\r\n  border-spacing: 0;\r\n  margin-bottom: 60px;\r\n}\r\n\r\n.order-table thead {\r\n  background-color: #f7f7f7;\r\n}\r\n\r\n.order-table thead th {\r\n  font-size: 16px;\r\n  color: #333;\r\n  width: 20%;\r\n  padding: 14px 0;\r\n  font-weight: 400;\r\n}\r\n\r\n.order-table td {\r\n  text-align: center;\r\n  padding: 20px 0;\r\n  color: #333;\r\n}\r\n\r\n.order-table .movie-name {\r\n  font-size: 16px;\r\n}\r\n\r\n.order-table .showtime {\r\n  font-size: 14px;\r\n  color: #f03d37;\r\n}\r\n\r\n.order-table .cinema-name {\r\n  font-size: 14px;\r\n}\r\n\r\n.order-table .hall {\r\n  display: inline-block;\r\n  font-size: 14px;\r\n  color: #424242;\r\n  font-weight: 700;\r\n  margin-right: 10px;\r\n  vertical-align: top;\r\n}\r\n\r\n.order-table .seats {\r\n  display: inline-flex;\r\n  text-align: left;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.order-table .seats span{\r\n  margin-right: 5px;\r\n}\r\n\r\n.bill-info-area{\r\n  display: flex;\r\n  justify-content: space-between;\r\n}\r\n\r\n.bill-cinema-name{\r\n  font-weight: 700;\r\n}\r\n\r\n.bill-cinema-info{\r\n  display: flex;\r\n  flex-direction: column;\r\n  margin-top: 15px;\r\n}\r\n\r\n.submit-bill{\r\n  margin-top: 40px;\r\n}\r\n\r\n.submit-bill span{\r\n  color: #f03d37;\r\n  font-size: 32px;\r\n  font-weight: 700;\r\n}\r\n\r\n.submit-bill span:before{\r\n  content: '￥';\r\n  font-size: 20px;\r\n}\r\n</style>\r\n"]}]}