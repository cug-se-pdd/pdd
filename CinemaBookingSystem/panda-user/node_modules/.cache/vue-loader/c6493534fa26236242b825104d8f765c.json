{"remainingRequest":"D:\\javaProjects\\pqq\\CinemaBookingSystem\\panda-user\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\javaProjects\\pqq\\CinemaBookingSystem\\panda-user\\src\\views\\pay\\BillDetail.vue?vue&type=style&index=0&id=f7e48f8e&scoped=true&lang=css","dependencies":[{"path":"D:\\javaProjects\\pqq\\CinemaBookingSystem\\panda-user\\src\\views\\pay\\BillDetail.vue","mtime":1715333545745},{"path":"D:\\javaProjects\\pqq\\CinemaBookingSystem\\panda-user\\node_modules\\css-loader\\dist\\cjs.js","mtime":1715002109893},{"path":"D:\\javaProjects\\pqq\\CinemaBookingSystem\\panda-user\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1715002115484},{"path":"D:\\javaProjects\\pqq\\CinemaBookingSystem\\panda-user\\node_modules\\postcss-loader\\src\\index.js","mtime":1715002113824},{"path":"D:\\javaProjects\\pqq\\CinemaBookingSystem\\panda-user\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1715002107957},{"path":"D:\\javaProjects\\pqq\\CinemaBookingSystem\\panda-user\\node_modules\\vue-loader\\lib\\index.js","mtime":1715002115483}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQouZWwtc3RlcCB7DQogIG1hcmdpbjogNDBweCBhdXRvOw0KfQ0KDQouYmlsbC1pbmZvLWNvbnRhaW5lcnsNCiAgd2lkdGg6IDgwJTsNCiAgbWFyZ2luOiAwIGF1dG8gNDBweCBhdXRvOw0KfQ0KDQouYmlsbC1pbmZvLXN0YXR1c3sNCiAgaGVpZ2h0OiAxMjBweDsNCiAgYmFja2dyb3VuZDogI0ZGRkJGMjsNCiAgZGlzcGxheTogZmxleDsNCiAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgbWFyZ2luLWJvdHRvbTogNDBweDsNCn0NCg0KLnBheS1pY29uew0KICB3aWR0aDogNDBweDsNCiAgaGVpZ2h0OjQwcHg7DQogIG1hcmdpbi1sZWZ0OiA1MHB4Ow0KfQ0KDQoucGF5LWljb24+aW1new0KICB3aWR0aDogMTAwJTsNCiAgaGVpZ2h0OiAxMDAlOw0KfQ0KDQoucGF5LWluZm97DQogIGRpc3BsYXk6IGZsZXg7DQogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47DQogIG1hcmdpbi1sZWZ0OiAyMHB4Ow0KfQ0KDQoucGF5LWluZm8tc3RhdHVzew0KICBjb2xvcjogI0ZBQUYwMDsNCiAgZm9udC1zaXplOiAyNHB4Ow0KICBmb250LXdlaWdodDogNzAwOw0KfQ0KDQoucGF5LWluZm8tZGVzY3sNCiAgY29sb3I6ICM5OTk7DQogIGZvbnQtc2l6ZTogMTNweDsNCn0NCg0KLnBheS1pbmZvLWRlc2M+c3BhbnsNCiAgZm9udC1zaXplOiAxNnB4Ow0KICBjb2xvcjogI2ZhYWYwMDsNCiAgbWFyZ2luOiA1cHggNXB4Ow0KfQ0KDQouYmlsbC1pbmZvLXN0YXR1cy5maW5pc2h7DQogIGJhY2tncm91bmQ6ICNGNEZGRjg7DQp9DQoNCi5iaWxsLWluZm8tc3RhdHVzLmludmFsaWR7DQogIGJhY2tncm91bmQ6ICNGRkUwRTA7DQp9DQoNCi5wYXktaW5mby1zdGF0dXMuZmluaXNoew0KICBjb2xvcjogIzI2Q0U2MTsNCn0NCg0KLnBheS1pbmZvLXN0YXR1cy5pbnZhbGlkew0KICBjb2xvcjogI2ZhYWFhYTsNCn0NCg0KLmJpbGwtaW5mby1oZWFkZXJ7DQogIGRpc3BsYXk6IGZsZXg7DQogIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsNCn0NCg0KLmJpbGwtaW5mby1oZWFkZXI+c3Bhbj5kaXZ7DQogIGNvbG9yOiAjZjAzZDM3Ow0KfQ0KDQouYmlsbC1pbmZvLWhlbHBlcnsNCiAgY29sb3I6ICM5OTk7DQogIGZvbnQtc2l6ZTogMTNweDsNCiAgZGlzcGxheTogZmxleDsNCiAgbWFyZ2luLWJvdHRvbTogOHB4Ow0KfQ0KDQoub3JkZXItdGFibGV7DQogIHdpZHRoOiAxMDAlOw0KICBib3JkZXI6IDFweCBzb2xpZCAjZTVlNWU1Ow0KICBib3JkZXItc3BhY2luZzogMDsNCiAgbWFyZ2luLWJvdHRvbTogNjBweDsNCn0NCg0KLm9yZGVyLXRhYmxlIHRoZWFkIHsNCiAgYmFja2dyb3VuZC1jb2xvcjogI2Y3ZjdmNzsNCn0NCg0KLm9yZGVyLXRhYmxlIHRoZWFkIHRoIHsNCiAgZm9udC1zaXplOiAxNnB4Ow0KICBjb2xvcjogIzMzMzsNCiAgd2lkdGg6IDIwJTsNCiAgcGFkZGluZzogMTRweCAwOw0KICBmb250LXdlaWdodDogNDAwOw0KfQ0KDQoub3JkZXItdGFibGUgdGQgew0KICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogIHBhZGRpbmc6IDIwcHggMDsNCiAgY29sb3I6ICMzMzM7DQp9DQoNCi5vcmRlci10YWJsZSAubW92aWUtbmFtZSB7DQogIGZvbnQtc2l6ZTogMTZweDsNCn0NCg0KLm9yZGVyLXRhYmxlIC5zaG93dGltZSB7DQogIGZvbnQtc2l6ZTogMTRweDsNCiAgY29sb3I6ICNmMDNkMzc7DQp9DQoNCi5vcmRlci10YWJsZSAuY2luZW1hLW5hbWUgew0KICBmb250LXNpemU6IDE0cHg7DQp9DQoNCi5vcmRlci10YWJsZSAuaGFsbCB7DQogIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgZm9udC1zaXplOiAxNHB4Ow0KICBjb2xvcjogIzQyNDI0MjsNCiAgZm9udC13ZWlnaHQ6IDcwMDsNCiAgbWFyZ2luLXJpZ2h0OiAxMHB4Ow0KICB2ZXJ0aWNhbC1hbGlnbjogdG9wOw0KfQ0KDQoub3JkZXItdGFibGUgLnNlYXRzIHsNCiAgZGlzcGxheTogaW5saW5lLWZsZXg7DQogIHRleHQtYWxpZ246IGxlZnQ7DQogIGZsZXgtd3JhcDogd3JhcDsNCn0NCg0KLm9yZGVyLXRhYmxlIC5zZWF0cyBzcGFuew0KICBtYXJnaW4tcmlnaHQ6IDVweDsNCn0NCg0KLmJpbGwtaW5mby1hcmVhew0KDQp9DQoNCi5iaWxsLWNpbmVtYS1uYW1lew0KICBmb250LXdlaWdodDogNzAwOw0KfQ0KDQouYmlsbC1jaW5lbWEtaW5mb3sNCiAgZGlzcGxheTogZmxleDsNCiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgbWFyZ2luLXRvcDogMTVweDsNCn0NCg0KLnN1Ym1pdC1iaWxsew0KICBtYXJnaW4tdG9wOiA0MHB4Ow0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQoNCn0NCi51cGxvYWQNCnsNCiAgbWFyZ2luLXRvcDogNDBweDsNCiAgbWFyZ2luLXJpZ2h0OiAxMCU7DQp9DQoNCi5zdWJtaXQtYmlsbCBzcGFuew0KICBjb2xvcjogI2YwM2QzNzsNCiAgZm9udC1zaXplOiAzMnB4Ow0KICBmb250LXdlaWdodDogNzAwOw0KfQ0KDQouc3VibWl0LWJpbGwgc3BhbjpiZWZvcmV7DQogIGNvbnRlbnQ6ICfvv6UnOw0KICBmb250LXNpemU6IDIwcHg7DQp9DQoNCi5hdmF0YXItdXBsb2FkZXIgLmVsLXVwbG9hZCB7DQogIGJvcmRlcjogMXB4IGRhc2hlZCAjZDlkOWQ5Ow0KICBib3JkZXItcmFkaXVzOiA2cHg7DQogIGN1cnNvcjogcG9pbnRlcjsNCiAgcG9zaXRpb246IHJlbGF0aXZlOw0KICBvdmVyZmxvdzogaGlkZGVuOw0KfQ0KLmF2YXRhci11cGxvYWRlciAuZWwtdXBsb2FkOmhvdmVyIHsNCiAgYm9yZGVyLWNvbG9yOiAjNDA5RUZGOw0KfQ0KLmF2YXRhci11cGxvYWRlci1pY29uIHsNCiAgZm9udC1zaXplOiAyOHB4Ow0KICBjb2xvcjogIzhjOTM5ZDsNCiAgd2lkdGg6IDE3OHB4Ow0KICBoZWlnaHQ6IDE3OHB4Ow0KICBsaW5lLWhlaWdodDogMTc4cHg7DQogIHRleHQtYWxpZ246IGNlbnRlcjsNCn0NCi5hdmF0YXIgew0KICB3aWR0aDogMTc4cHg7DQogIGhlaWdodDogMTc4cHg7DQogIGRpc3BsYXk6IGJsb2NrOw0KfQ0KDQouYnV0dG9uLXJvdyB7DQogIG1hcmdpbi10b3A6IDIwcHg7IC8qIOiwg+aVtOaMiemSruS4juS4iuaWueWFg+e0oOeahOi3neemuyAqLw0KfQ0KDQouYnV0dG9uLWdyb3VwIHsNCiAgdGV4dC1hbGlnbjogY2VudGVyOyAvKiDnoa7kv53miYDmnInmjInpkq7pg73lnKjlhbbliJflhoXlsYXkuK0gKi8NCn0NCi51cGxvYWQtaW1hZ2UtY29udGFpbmVyDQp7DQogIHRleHQtYWxpZ246IGNlbnRlcjsgLyog56Gu5L+d5omA5pyJ5oyJ6ZKu6YO95Zyo5YW25YiX5YaF5bGF5LitICovDQogIG1hcmdpbi10b3A6IDIwcHg7DQp9DQouY2luZW1hLWluZm8NCnsNCiAgdGV4dC1hbGlnbjogY2VudGVyOw0KDQp9DQoudGFnDQp7DQogIG1hcmdpbi10b3A6IDhweDsNCiAgdGV4dC1hbGlnbjogY2VudGVyOw0KfQ0KDQo="},{"version":3,"sources":["BillDetail.vue"],"names":[],"mappings":";AA6ZA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"BillDetail.vue","sourceRoot":"src/views/pay","sourcesContent":["<template>\r\n  <div>\r\n    <el-steps :active=\"3\" align-center>\r\n      <el-step title=\"选择活动场次\"></el-step>\r\n      <el-step title=\"选择座位\"></el-step>\r\n      <el-step title=\"15分钟内提交\"></el-step>\r\n      <el-step title=\"活动地点取票观影\" status=\"wait\"></el-step>\r\n    </el-steps>\r\n    <div class=\"bill-info-container\">\r\n      <!-- 预约状态 -->\r\n      <!-- 未支付，未取消，15分钟内 -->\r\n      <div class=\"bill-info-status\" v-if=\"payState === false && cancelState === false && (minutes > 0 || seconds > 0)\">\r\n        <div class=\"pay-icon\">\r\n          <img src=\"../../assets/money.png\">\r\n        </div>\r\n        <div class=\"pay-info\">\r\n          <div class=\"pay-info-status\">验证</div>\r\n          <div class=\"pay-info-desc\">请在<span>{{minutes}}分钟{{seconds}}秒</span>内完成验证</div>\r\n\r\n        </div>\r\n      </div>\r\n      <!-- 未支付，超时取消，15分钟 -->\r\n      <div class=\"bill-info-status invalid\" v-if=\"payState === false && cancelState === true && cancelTime === null && minutes <= 0 && seconds <= 0\">\r\n        <div class=\"pay-icon\">\r\n          <img src=\"../../assets/bill-invalid.png\">\r\n        </div>\r\n        <div class=\"pay-info\">\r\n          <div class=\"pay-info-status invalid\">由于预约超时未提交，已失效</div>\r\n        </div>\r\n      </div>\r\n      <div class=\"bill-info-status finish\" v-if=\"payState === true\">\r\n        <div class=\"pay-icon\">\r\n          <img src=\"../../assets/finish.png\">\r\n        </div>\r\n        <div class=\"pay-info\">\r\n          <div class=\"pay-info-status finish\">已完成</div>\r\n        </div>\r\n      </div>\r\n      <div class=\"bill-info-status invalid\" v-if=\"cancelState === true && cancelTime !== null\">\r\n        <div class=\"pay-icon\">\r\n          <img src=\"../../assets/bill-invalid.png\">\r\n        </div>\r\n        <div class=\"pay-info\">\r\n          <div class=\"pay-info-status invalid\">预约已取消</div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- 预约信息 -->\r\n      <div class=\"bill-info-desc\">\r\n        <div class=\"bill-info-header\">\r\n          <span>预约编号: {{billInfo.billId}}</span>\r\n          <span class=\"bill-info-helper\">\r\n            (有预约问题可拨打客服电话<div>{{billInfo.sysSession.sysHall.sysCinema.cinemaPhone}}</div>，\r\n            工作时间: {{billInfo.sysSession.sysHall.sysCinema.workStartTime}}-{{billInfo.sysSession.sysHall.sysCinema.workEndTime}})</span>\r\n        </div>\r\n\r\n        <table class=\"order-table\">\r\n          <thead>\r\n          <tr>\r\n            <th>活动</th>\r\n<!--            <th>语言版本</th>-->\r\n            <th>活动时间</th>\r\n<!--            <th>座位{{billInfo.url}}</th>-->\r\n            <th>座位</th>\r\n            <th>提示信息</th>\r\n          </tr>\r\n          </thead>\r\n          <tbody>\r\n          <tr>\r\n            <td class=\"movie-name\">《{{billInfo.sysSession.sysMovie.movieName}}》</td>\r\n<!--            <td class=\"movie-name\">{{billInfo.sysSession.languageVersion}}</td>-->\r\n            <td class=\"showtime\">{{billInfo.sysSession.sessionDate}} {{billInfo.sysSession.playTime}} - {{billInfo.sysSession.endTime}}</td>\r\n            <td>\r\n              <span class=\"hall\">{{billInfo.sysSession.sysHall.hallName}}</span>\r\n              <div class=\"seats\">\r\n                <span class=\"bill-seat\" v-for=\"item in billSeats\" :key=\"item\"> {{item}} </span>\r\n              </div>\r\n            </td>\r\n            <td>\r\n              <span>{{billInfo.sysSession.sessionTips}}</span>\r\n            </td>\r\n          </tr>\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n      <!-- 活动地点信息、提交预约 -->\r\n      <div class=\"bill-info-area\">\r\n        <el-row :gutter=\"20\" type=\"flex\" justify=\"center\">\r\n          <el-col :span=\"18\">\r\n\r\n\r\n\r\n\r\n        <div class=\"cinema-info\">\r\n          <span class=\"bill-cinema-name\">{{ billInfo.sysSession.sysMovie.movieName }}</span>\r\n          <div class=\"bill-cinema-info\">\r\n            <span>活动要求：\r\n              {{ billInfo.sysSession.sysMovie.movieArea }} </span>\r\n\r\n\r\n          </div>\r\n        </div>\r\n\r\n        <!-- 统一位置的Upload和Image组件 -->\r\n\r\n        <div class=\"upload-image-container\">\r\n          <!-- 上传组件：当还未支付且未取消，并且时间还剩余时显示 -->\r\n\r\n          <el-upload\r\n            v-if=\"payState === false && cancelState === false && (minutes > 0 || seconds > 0)\"\r\n            action=\"#\"\r\n            list-type=\"picture-card\"\r\n            :file-list=\"poster\"\r\n            :on-exceed=\"handleExceed\"\r\n            :auto-upload=\"false\"\r\n            :on-change=\"handleChangeP\"\r\n            :on-success=\"handleSuccessP\"\r\n            :on-error=\"handleError\"\r\n            ref=\"posterRef\"\r\n            :http-request=\"submitFileP\"\r\n            class=\"upload-component\"\r\n          >\r\n            <i slot=\"default\" class=\"el-icon-plus\"></i>\r\n            <div slot=\"file\" slot-scope=\"{ file }\">\r\n              <img class=\"el-upload-list__item-thumbnail\" :src=\"file.url\" alt=\"\">\r\n              <span class=\"el-upload-list__item-actions\">\r\n          <span class=\"el-upload-list__item-preview\" @click=\"handlePictureCardPreview(file)\">\r\n            <i class=\"el-icon-zoom-in\"></i>\r\n          </span>\r\n          <span v-if=\"!disabled\" class=\"el-upload-list__item-delete\" @click=\"handleRemove(file)\">\r\n            <i class=\"el-icon-delete\"></i>\r\n          </span>\r\n        </span>\r\n            </div>\r\n          </el-upload>\r\n          <!-- 图像显示组件：当支付已完成或条件不满足显示上传组件时显示 -->\r\n          <div v-else class=\"image-component\">\r\n<!--            <el-image-->\r\n<!--              fit=\"cover\"-->\r\n<!--              class=\"default-img\"-->\r\n<!--              v-for=\"(item,index) in billInfo.url\"-->\r\n<!--              :key=\"index\"-->\r\n<!--              :src=\"item\"-->\r\n<!--              :preview-src-list=\"billInfo.url\">-->\r\n<!--            ></el-image>-->\r\n            <el-carousel :interval=\"4000\" type=\"card\" height=\"400px\">\r\n              <el-carousel-item  v-for=\"(item,index) in billInfo.url\"\r\n                                 :key=\"index\"\r\n                                 :src=\"item\">\r\n                <el-image style=\"width: 400px; height: 400px\" :src=\"item\" :fit=\"contain\"/>\r\n              </el-carousel-item>\r\n            </el-carousel>\r\n          </div>\r\n\r\n          <div class=\"tag\">\r\n            <el-tag type=\"info\">按活动要求上传验证图片</el-tag>\r\n          </div>\r\n\r\n        </div>\r\n          </el-col>\r\n        </el-row>\r\n        <el-row type=\"flex\" justify=\"center\" class=\"button-row\">\r\n          <el-col :span=\"12\">\r\n            <div class=\"button-group\" v-if=\"payState === false && cancelState === false && (minutes > 0 || seconds > 0)\">\r\n              <el-button @click=\"payForBill\" type=\"primary\" style=\"margin-right: 10px;\" round>提交预约</el-button>\r\n              <el-button @click=\"cancelForBill\" type=\"danger\" round>取消预约</el-button>\r\n            </div>\r\n          </el-col>\r\n        </el-row>\r\n\r\n\r\n\r\n\r\n      </div>\r\n\r\n    </div>\r\n    </div>\r\n\r\n</template>\r\n\r\n<script>\r\nimport moment from 'moment'\r\nexport default {\r\n  name: \"BillDetail\",\r\n  data() {\r\n    return {\r\n      billId: this.$route.params.billId,\r\n      billInfo: {\r\n        sysSession: {\r\n          sysMovie: {},\r\n          sysHall: {\r\n            sysCinema: {\r\n              user: {}\r\n            }\r\n          }\r\n        },\r\n        url:[]\r\n        ,\r\n      },\r\n      billSeats: [],\r\n      payState: null,\r\n      url:null,\r\n      cancelState: null,\r\n      cancelTime: null,\r\n      //计时\r\n      minutes: 1,\r\n      seconds: 0,\r\n      dialogImageUrl: '',\r\n      dialogVisible: false,\r\n      disabled: false,\r\n      poster: [],\r\n      pictureList: [],\r\n      imageSrc:[],\r\n      httpURL: this.global.base\r\n    }\r\n  },\r\n  created() {\r\n    this.getBillInfo()\r\n  },\r\n  mounted() {\r\n    this.add()\r\n  },\r\n  methods: {\r\n    async getBillInfo() {\r\n      // console.log(\"this.billId:\", this.billId); // 输出 this.billId 的值\r\n      const { data : res } = await axios.get('sysBill/' + this.billId)\r\n      if(res.code !== 200) return this.$message.error('获取信息失败')\r\n      let userId = JSON.parse(window.sessionStorage.getItem('loginUser')).userId\r\n      if (userId !== res.data.userId) {\r\n        this.$alert('非法操作！操作非本人预约。', '非法操作预约警告', {\r\n          confirmButtonText: '我知道了',\r\n          callback: action => {\r\n            this.$router.push('/bill')\r\n          }\r\n        })\r\n        return\r\n      }\r\n      this.billInfo = res.data\r\n\r\n      this.cancelTime = this.billInfo.cancelTime\r\n      this.url=this.billInfo.url\r\n      this.imageSrc=this.billInfo.url\r\n\r\n\r\n      console.log(this.billInfo)\r\n      // 截止时间\r\n      console.log(this.billInfo.deadline)\r\n      //处理预约座位信息\r\n      this.billSeats = JSON.parse(this.billInfo.seats)\r\n      this.payState = this.billInfo.payState\r\n      this.cancelState = this.billInfo.cancelState\r\n      console.log('the create_time'+this.billInfo.createTime)\r\n      this.billInfo.url = JSON.parse(this.billInfo.url).map((obj, index) => {\r\n        return this.httpURL + obj\r\n      })\r\n      this.computeLeftTime()\r\n    },\r\n    async payForBill() {\r\n      await this.submitFileP()\r\n      //更新预约状态\r\n      this.billInfo.payState = true\r\n      this.billInfo.url=JSON.stringify(this.pictureList)\r\n      //更新预约信息和场次座位信息\r\n      axios.defaults.headers.put['Content-Type'] = 'application/json'\r\n      const { data: res} = await axios.put('sysBill', JSON.stringify(this.billInfo))\r\n      if(res.code !== 200) return this.$message.error('支付失败')\r\n      this.payState = true\r\n      this.$alert('预约成功！您可以前往个人中心查看预约信息', '预约通知', {\r\n        confirmButtonText: '我知道了',\r\n        callback: action => {\r\n          this.$router.push('/bill')\r\n        }\r\n      })\r\n    },\r\n    handleAvatarSuccess(res, file) {\r\n      this.imageUrl = URL.createObjectURL(file.raw);\r\n    },\r\n    beforeAvatarUpload(file) {\r\n      const isJPG = file.type === 'image/jpeg';\r\n      const isLt2M = file.size / 1024 / 1024 < 2;\r\n\r\n      if (!isJPG) {\r\n        this.$message.error('上传头像图片只能是 JPG 格式!');\r\n      }\r\n      if (!isLt2M) {\r\n        this.$message.error('上传头像图片大小不能超过 2MB!');\r\n      }\r\n      return isJPG && isLt2M;\r\n    },\r\n    handleRemove(file) {\r\n      console.log(file);\r\n    },\r\n    handleChangeP(file, filelist) {\r\n      this.poster = filelist\r\n      console.log(this.poster)\r\n    },\r\n    handleSuccessP(response) {\r\n      this.pictureList.push(response.data)\r\n      this.addForm = JSON.stringify(this.pictureList)\r\n      this.editForm = JSON.stringify(this.pictureList)\r\n    },\r\n    handleError(err) {\r\n      console.log(err)\r\n    },\r\n    handlePictureCardPreview(file) {\r\n      this.dialogImageUrl = file.url;\r\n      this.dialogVisible = true;\r\n    },\r\n    async submitFileP() {\r\n      const _this = this\r\n      for (let i = 0; i < this.poster.length; i++) {\r\n        let formData = new FormData()\r\n        if (this.poster[i].status === 'success') {\r\n          let s = this.poster[i].url\r\n          this.pictureList.push(s.substring(s.indexOf('/images')))\r\n          continue\r\n        }\r\n        let file = this.poster[i].raw\r\n        formData.append('file', file)\r\n        await axios.post('upload/bill', formData).then(response => {\r\n          _this.pictureList.push(response.data.data)\r\n        })\r\n      }\r\n    },\r\n    handleDownload(file) {\r\n      console.log(file);\r\n    },\r\n    async cancelForBill() {\r\n      //更新预约状态\r\n      this.billInfo.cancelState = true\r\n      this.billInfo.cancelTime = moment(new Date()).format('YYYY-MM-DD HH:mm:ss')\r\n      // 获取场次座位信息\r\n      const { data : curSession } = await axios.get('sysSession/find/' + this.billInfo.sessionId)\r\n      let sessionSeats = JSON.parse(curSession.data.sessionSeats)\r\n      // 解析出预约选择的座位，更新座位信息\r\n      for(let seat of this.billSeats){\r\n        let row = seat.substring(0, seat.indexOf('排'))\r\n        let col = Number.parseInt(seat.substring(seat.indexOf('排') + 1, seat.length - 1))\r\n        sessionSeats[row][col - 1] = 0\r\n      }\r\n      // 更新预约信息和场次座位信息\r\n      axios.defaults.headers.put['Content-Type'] = 'application/json'\r\n      const { data: res } = await axios.put('sysBill/cancel',JSON.stringify({sysBill: this.billInfo, sessionSeats: JSON.stringify(sessionSeats)}))\r\n      if(res.code !== 200) return this.$message.error('取消失败')\r\n\r\n      this.payState = false\r\n      this.cancelState = true\r\n      this.$alert('取消成功！您可以前往个人中心查看预约信息', '取消通知', {\r\n        confirmButtonText: '我知道了',\r\n        callback: action => {\r\n          this.$router.push('/billDetail/' + this.billInfo.billId)\r\n        }\r\n      })\r\n    },\r\n    computeLeftTime() {\r\n      let cur = new Date()\r\n      let createTime = new Date(this.billInfo.createTime)\r\n      let diff = 15 * 60 - (cur - createTime) / 1000\r\n      if (diff < 0) {\r\n        this.minutes = 0\r\n        this.seconds = 0\r\n      } else {\r\n        this.minutes = Math.floor(diff / 60)\r\n        this.seconds = Math.floor(diff % 60)\r\n      }\r\n    },\r\n    handleExceed(){\r\n      this.$message.error('活动封面不能超过一张!')\r\n    },\r\n    //计时转换数字格式\r\n    num: function (n) {\r\n      return n < 10 ? '0' + n : '' + n\r\n    },\r\n    //计时走动\r\n    add: function () {\r\n      let _this = this\r\n      let time = window.setInterval(function () {\r\n        if (_this.seconds === 0 && _this.minutes !== 0) {\r\n          _this.seconds = 59\r\n          _this.minutes -= 1\r\n        } else if (_this.minutes === 0 && _this.seconds === 0) {\r\n          _this.seconds = 0\r\n          window.clearInterval(time)\r\n        } else {\r\n          _this.seconds -= 1\r\n        }\r\n      }, 1000)\r\n    },\r\n  },\r\n  watch: {\r\n    second: {\r\n      handler (newVal) {\r\n        this.num(newVal)\r\n      }\r\n    },\r\n    minute: {\r\n      handler (newVal) {\r\n        this.num(newVal)\r\n      }\r\n    }\r\n  },\r\n  computed: {\r\n    second: function () {\r\n      return this.num(this.seconds)\r\n    },\r\n    minute: function () {\r\n      return this.num(this.minutes)\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.el-step {\r\n  margin: 40px auto;\r\n}\r\n\r\n.bill-info-container{\r\n  width: 80%;\r\n  margin: 0 auto 40px auto;\r\n}\r\n\r\n.bill-info-status{\r\n  height: 120px;\r\n  background: #FFFBF2;\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 40px;\r\n}\r\n\r\n.pay-icon{\r\n  width: 40px;\r\n  height:40px;\r\n  margin-left: 50px;\r\n}\r\n\r\n.pay-icon>img{\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.pay-info{\r\n  display: flex;\r\n  flex-direction: column;\r\n  margin-left: 20px;\r\n}\r\n\r\n.pay-info-status{\r\n  color: #FAAF00;\r\n  font-size: 24px;\r\n  font-weight: 700;\r\n}\r\n\r\n.pay-info-desc{\r\n  color: #999;\r\n  font-size: 13px;\r\n}\r\n\r\n.pay-info-desc>span{\r\n  font-size: 16px;\r\n  color: #faaf00;\r\n  margin: 5px 5px;\r\n}\r\n\r\n.bill-info-status.finish{\r\n  background: #F4FFF8;\r\n}\r\n\r\n.bill-info-status.invalid{\r\n  background: #FFE0E0;\r\n}\r\n\r\n.pay-info-status.finish{\r\n  color: #26CE61;\r\n}\r\n\r\n.pay-info-status.invalid{\r\n  color: #faaaaa;\r\n}\r\n\r\n.bill-info-header{\r\n  display: flex;\r\n  justify-content: space-between;\r\n}\r\n\r\n.bill-info-header>span>div{\r\n  color: #f03d37;\r\n}\r\n\r\n.bill-info-helper{\r\n  color: #999;\r\n  font-size: 13px;\r\n  display: flex;\r\n  margin-bottom: 8px;\r\n}\r\n\r\n.order-table{\r\n  width: 100%;\r\n  border: 1px solid #e5e5e5;\r\n  border-spacing: 0;\r\n  margin-bottom: 60px;\r\n}\r\n\r\n.order-table thead {\r\n  background-color: #f7f7f7;\r\n}\r\n\r\n.order-table thead th {\r\n  font-size: 16px;\r\n  color: #333;\r\n  width: 20%;\r\n  padding: 14px 0;\r\n  font-weight: 400;\r\n}\r\n\r\n.order-table td {\r\n  text-align: center;\r\n  padding: 20px 0;\r\n  color: #333;\r\n}\r\n\r\n.order-table .movie-name {\r\n  font-size: 16px;\r\n}\r\n\r\n.order-table .showtime {\r\n  font-size: 14px;\r\n  color: #f03d37;\r\n}\r\n\r\n.order-table .cinema-name {\r\n  font-size: 14px;\r\n}\r\n\r\n.order-table .hall {\r\n  display: inline-block;\r\n  font-size: 14px;\r\n  color: #424242;\r\n  font-weight: 700;\r\n  margin-right: 10px;\r\n  vertical-align: top;\r\n}\r\n\r\n.order-table .seats {\r\n  display: inline-flex;\r\n  text-align: left;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.order-table .seats span{\r\n  margin-right: 5px;\r\n}\r\n\r\n.bill-info-area{\r\n\r\n}\r\n\r\n.bill-cinema-name{\r\n  font-weight: 700;\r\n}\r\n\r\n.bill-cinema-info{\r\n  display: flex;\r\n  flex-direction: column;\r\n  margin-top: 15px;\r\n}\r\n\r\n.submit-bill{\r\n  margin-top: 40px;\r\n  position: absolute;\r\n\r\n}\r\n.upload\r\n{\r\n  margin-top: 40px;\r\n  margin-right: 10%;\r\n}\r\n\r\n.submit-bill span{\r\n  color: #f03d37;\r\n  font-size: 32px;\r\n  font-weight: 700;\r\n}\r\n\r\n.submit-bill span:before{\r\n  content: '￥';\r\n  font-size: 20px;\r\n}\r\n\r\n.avatar-uploader .el-upload {\r\n  border: 1px dashed #d9d9d9;\r\n  border-radius: 6px;\r\n  cursor: pointer;\r\n  position: relative;\r\n  overflow: hidden;\r\n}\r\n.avatar-uploader .el-upload:hover {\r\n  border-color: #409EFF;\r\n}\r\n.avatar-uploader-icon {\r\n  font-size: 28px;\r\n  color: #8c939d;\r\n  width: 178px;\r\n  height: 178px;\r\n  line-height: 178px;\r\n  text-align: center;\r\n}\r\n.avatar {\r\n  width: 178px;\r\n  height: 178px;\r\n  display: block;\r\n}\r\n\r\n.button-row {\r\n  margin-top: 20px; /* 调整按钮与上方元素的距离 */\r\n}\r\n\r\n.button-group {\r\n  text-align: center; /* 确保所有按钮都在其列内居中 */\r\n}\r\n.upload-image-container\r\n{\r\n  text-align: center; /* 确保所有按钮都在其列内居中 */\r\n  margin-top: 20px;\r\n}\r\n.cinema-info\r\n{\r\n  text-align: center;\r\n\r\n}\r\n.tag\r\n{\r\n  margin-top: 8px;\r\n  text-align: center;\r\n}\r\n\r\n</style>\r\n"]}]}