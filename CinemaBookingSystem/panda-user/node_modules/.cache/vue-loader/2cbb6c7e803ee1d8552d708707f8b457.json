{"remainingRequest":"F:\\Code\\CinemaBookingSystem\\panda-user\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\Code\\CinemaBookingSystem\\panda-user\\src\\views\\user\\UserInfo.vue?vue&type=style&index=0&id=735816d3&scoped=true&lang=css","dependencies":[{"path":"F:\\Code\\CinemaBookingSystem\\panda-user\\src\\views\\user\\UserInfo.vue","mtime":1714207564487},{"path":"F:\\Code\\CinemaBookingSystem\\panda-user\\node_modules\\css-loader\\dist\\cjs.js","mtime":1714213962763},{"path":"F:\\Code\\CinemaBookingSystem\\panda-user\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1714213965216},{"path":"F:\\Code\\CinemaBookingSystem\\panda-user\\node_modules\\postcss-loader\\src\\index.js","mtime":1714213963683},{"path":"F:\\Code\\CinemaBookingSystem\\panda-user\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1714213961883},{"path":"F:\\Code\\CinemaBookingSystem\\panda-user\\node_modules\\vue-loader\\lib\\index.js","mtime":1714213964412}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQoudXNlci1pbmZvLWNvbnRhaW5lcnsNCiAgZGlzcGxheTogZmxleDsNCn0NCg=="},{"version":3,"sources":["UserInfo.vue"],"names":[],"mappings":";AAsLA;AACA;AACA","file":"UserInfo.vue","sourceRoot":"src/views/user","sourcesContent":["<template>\r\n<div class=\"user-info-container\">\r\n  <div style=\"width: 30%\">\r\n    <h1>用户头像</h1>\r\n    <el-upload action=\"\"\r\n               list-type=\"picture-card\"\r\n               :auto-upload=\"false\"\r\n               :limit=\"1\"\r\n               :file-list=\"pics\"\r\n               :on-change=\"handleChange\"\r\n               :on-success=\"handleSuccess\"\r\n               :on-error=\"handleError\"\r\n               :on-exceed=\"handleExceed\"\r\n               ref=\"pictureRef\"\r\n               :http-request=\"submitFile\">\r\n      <i slot=\"default\" class=\"el-icon-plus\"></i>\r\n      <div slot=\"file\" slot-scope=\"{file}\">\r\n        <img class=\"el-upload-list__item-thumbnail\" :src=\"(picDialog? '' : global.base)+file.url\" alt=\"\">\r\n        <span class=\"el-upload-list__item-actions\">\r\n          <span class=\"el-upload-list__item-delete\" @click=\"handleRemove(file)\">\r\n            <i class=\"el-icon-delete\"></i>\r\n          </span>\r\n        </span>\r\n      </div>\r\n    </el-upload>\r\n  </div>\r\n  <div style=\"width: 70%\">\r\n    <el-form :model=\"loginUser\"  :rules=\"loginUserRules\" ref=\"editFormRef\" label-width=\"80px\">\r\n      <el-form-item label=\"用户名\" prop=\"userName\">\r\n        <el-input v-model=\"loginUser.userName\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"电子邮箱\" prop=\"email\">\r\n        <el-input v-model=\"loginUser.email\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"手机号码\" prop=\"phoneNumber\">\r\n        <el-input v-model=\"loginUser.phoneNumber\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"性别\" prop=\"sex\">\r\n          <el-radio v-model=\"loginUser.sex\" :label=\"true\">男</el-radio>\r\n          <el-radio v-model=\"loginUser.sex\" :label=\"false\">女</el-radio>\r\n      </el-form-item>\r\n      <el-form-item label=\"生日\" prop=\"birthday\">\r\n        <el-date-picker\r\n            v-model=\"loginUser.birthday\"\r\n            value-format=\"yyyy-MM-dd\"\r\n            type=\"date\"\r\n            placeholder=\"选择日期\"></el-date-picker>\r\n      </el-form-item>\r\n      <el-form-item label=\"个性签名\" prop=\"autograph\">\r\n        <el-input v-model=\"loginUser.autograph\"></el-input>\r\n      </el-form-item>\r\n        <el-button type=\"primary\" @click=\"editUser\">保存</el-button>\r\n    </el-form>\r\n  </div>\r\n</div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"UserInfo\",\r\n  data() {\r\n    let checkEmail = (rule, value, cb) => {\r\n      const regEmail = /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\\.[a-zA-Z0-9_-])+/\r\n      if (regEmail.test(value)){\r\n        return cb()\r\n      }\r\n      cb(new Error('请输入合法的邮箱'))\r\n    }\r\n    let checkMobile = (rule, value, cb) => {\r\n      const regMobile = /^(0|86|17951)?(13[0-9]|15[0123456789]|17[678]|18[0-9]|14[57])[0-9]{8}$/\r\n      if (regMobile.test(value)){\r\n        return cb()\r\n      }\r\n      cb(new Error('请输入合法的手机号码'))\r\n    }\r\n    return {\r\n      picDialog:false,\r\n      loginUser:{},\r\n      pics:[],\r\n      pictureList:[],\r\n      picSrc:\"\",\r\n      deletePicList:[],\r\n\r\n      //验证表单规则对象\r\n      loginUserRules: {\r\n        userName: [\r\n          { required: true, message: '请输入用户名', trigger: 'blur' }\r\n        ],\r\n        email: [\r\n          { required: true, message: '请输入电子邮箱', trigger: 'blur' },\r\n          { validator: checkEmail, trigger: 'blur'}\r\n        ],\r\n        phoneNumber: [\r\n          { required: true, message: '请输入手机号码', trigger: 'blur' },\r\n          { validator: checkMobile, trigger: 'blur'}\r\n        ],\r\n        sex: [\r\n          { required: true, message: '请选择性别', trigger: 'change' }\r\n        ],\r\n        birthday: [\r\n          { required: true, message: '请选择生日', trigger: 'change' }\r\n        ]\r\n      }\r\n    }\r\n  },\r\n  created() {\r\n    this.getUser()\r\n  },\r\n  methods:{\r\n    async getUser(){\r\n      const { data : res } = await axios.get('sysUser/'+JSON.parse(window.sessionStorage.getItem('loginUser')).userId)\r\n      this.loginUser = res.data\r\n      this.pics.push({name:'picture',url:JSON.parse(this.loginUser.userPicture)[0]})\r\n    },\r\n    async handleSuccess(response, file, fileList){\r\n      this.pics = fileList\r\n      console.log(this.pics)\r\n      await this.submitFile()\r\n      this.picSrc = this.pictureList[0]\r\n    },\r\n    handleError(err){\r\n      console.log(err)\r\n    },\r\n    handleChange(file, filelist){\r\n      this.pics = filelist.slice(0)\r\n      console.log(111)\r\n      console.log(this.pics)\r\n      this.picDialog =true\r\n    },\r\n    handleRemove(file) {\r\n      const filePath = file.url\r\n      console.log(filePath)\r\n      const idx = this.pics.findIndex(x => x.url === filePath)\r\n      if(file.status === 'success'){\r\n        this.deletePicList.push(file.url)\r\n      }\r\n      this.pics.splice(idx, 1)\r\n    },\r\n     async editUser(){\r\n       await this.submitFile()\r\n       this.loginUser.userPicture = JSON.stringify(this.pictureList)\r\n       const _this = this\r\n       let success = true\r\n       axios.defaults.headers.put['Content-Type'] = 'application/json'\r\n       await axios.put('sysUser',JSON.stringify(this.loginUser)).then(resp=>{\r\n         if (resp.data.code !== 200){\r\n           this.$message.error('修改用户信息失败！')\r\n           success = false\r\n         }\r\n       })\r\n       if(!success) return\r\n       this.$message.success('修改用户信息成功!')\r\n       this.pics = []\r\n       this.pictureList = []\r\n       await this.getUser()\r\n       this.picDialog = false\r\n    },\r\n    async submitFile(){\r\n      const _this = this\r\n      for (let i = 0; i < this.pics.length; i++){\r\n        let formData = new FormData()\r\n        if (this.pics[i].status === 'success') {\r\n          let s = this.pics[i].url\r\n          this.pictureList.push(s.substring(s.indexOf('/images')))\r\n          continue\r\n        }\r\n        let file = this.pics[i].raw\r\n        formData.append('file', file)\r\n        await axios.post('upload/user', formData).then(response =>{\r\n          console.log(response)\r\n          _this.pictureList.push(response.data.data)\r\n        })\r\n      }\r\n    },\r\n    handleExceed(){\r\n      this.$message.error(\"用户头像最多上传一张！\")\r\n    },\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.user-info-container{\r\n  display: flex;\r\n}\r\n</style>\r\n"]}]}