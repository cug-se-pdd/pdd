{"remainingRequest":"F:\\Code\\CinemaBookingSystem\\panda-user\\node_modules\\babel-loader\\lib\\index.js!F:\\Code\\CinemaBookingSystem\\panda-user\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!F:\\Code\\CinemaBookingSystem\\panda-user\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\Code\\CinemaBookingSystem\\panda-user\\src\\views\\pay\\BillDetail.vue?vue&type=script&lang=js","dependencies":[{"path":"F:\\Code\\CinemaBookingSystem\\panda-user\\src\\views\\pay\\BillDetail.vue","mtime":1714207564481},{"path":"F:\\Code\\CinemaBookingSystem\\panda-user\\babel.config.js","mtime":1714207564419},{"path":"F:\\Code\\CinemaBookingSystem\\panda-user\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1714213961883},{"path":"F:\\Code\\CinemaBookingSystem\\panda-user\\node_modules\\babel-loader\\lib\\index.js","mtime":1714213963702},{"path":"F:\\Code\\CinemaBookingSystem\\panda-user\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1714213961883},{"path":"F:\\Code\\CinemaBookingSystem\\panda-user\\node_modules\\vue-loader\\lib\\index.js","mtime":1714213964412}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyI7CmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JzsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJCaWxsRGV0YWlsIiwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgYmlsbElkOiB0aGlzLiRyb3V0ZS5wYXJhbXMuYmlsbElkLAogICAgICBiaWxsSW5mbzogewogICAgICAgIHN5c1Nlc3Npb246IHsKICAgICAgICAgIHN5c01vdmllOiB7fSwKICAgICAgICAgIHN5c0hhbGw6IHsKICAgICAgICAgICAgc3lzQ2luZW1hOiB7CiAgICAgICAgICAgICAgdXNlcjoge30KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgYmlsbFNlYXRzOiBbXSwKICAgICAgcGF5U3RhdGU6IG51bGwsCiAgICAgIGNhbmNlbFN0YXRlOiBudWxsLAogICAgICBjYW5jZWxUaW1lOiBudWxsLAogICAgICAvL+iuoeaXtgogICAgICBtaW51dGVzOiAxLAogICAgICBzZWNvbmRzOiAwCiAgICB9OwogIH0sCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMuZ2V0QmlsbEluZm8oKTsKICB9LAogIG1vdW50ZWQoKSB7CiAgICB0aGlzLmFkZCgpOwogIH0sCiAgbWV0aG9kczogewogICAgYXN5bmMgZ2V0QmlsbEluZm8oKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkYXRhOiByZXMKICAgICAgfSA9IGF3YWl0IGF4aW9zLmdldCgnc3lzQmlsbC8nICsgdGhpcy5iaWxsSWQpOwogICAgICBpZiAocmVzLmNvZGUgIT09IDIwMCkgcmV0dXJuIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+iOt+WPluS/oeaBr+Wksei0pScpOwogICAgICBsZXQgdXNlcklkID0gSlNPTi5wYXJzZSh3aW5kb3cuc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnbG9naW5Vc2VyJykpLnVzZXJJZDsKICAgICAgaWYgKHVzZXJJZCAhPT0gcmVzLmRhdGEudXNlcklkKSB7CiAgICAgICAgdGhpcy4kYWxlcnQoJ+mdnuazleaTjeS9nO+8geaTjeS9nOmdnuacrOS6uuiuouWNleOAgicsICfpnZ7ms5Xmk43kvZzorqLljZXorablkYonLCB7CiAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ+aIkeefpemBk+S6hicsCiAgICAgICAgICBjYWxsYmFjazogYWN0aW9uID0+IHsKICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goJy9iaWxsJyk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMuYmlsbEluZm8gPSByZXMuZGF0YTsKICAgICAgdGhpcy5jYW5jZWxUaW1lID0gdGhpcy5iaWxsSW5mby5jYW5jZWxUaW1lOwogICAgICBjb25zb2xlLmxvZyh0aGlzLmJpbGxJbmZvKTsKICAgICAgLy8g5oiq5q2i5pe26Ze0CiAgICAgIGNvbnNvbGUubG9nKHRoaXMuYmlsbEluZm8uZGVhZGxpbmUpOwogICAgICAvL+WkhOeQhuiuouWNleW6p+S9jeS/oeaBrwogICAgICB0aGlzLmJpbGxTZWF0cyA9IEpTT04ucGFyc2UodGhpcy5iaWxsSW5mby5zZWF0cyk7CiAgICAgIHRoaXMucGF5U3RhdGUgPSB0aGlzLmJpbGxJbmZvLnBheVN0YXRlOwogICAgICB0aGlzLmNhbmNlbFN0YXRlID0gdGhpcy5iaWxsSW5mby5jYW5jZWxTdGF0ZTsKICAgICAgY29uc29sZS5sb2coJ3RoZSBjcmVhdGVfdGltZScgKyB0aGlzLmJpbGxJbmZvLmNyZWF0ZVRpbWUpOwogICAgICB0aGlzLmNvbXB1dGVMZWZ0VGltZSgpOwogICAgfSwKICAgIGFzeW5jIHBheUZvckJpbGwoKSB7CiAgICAgIC8v5pu05paw6K6i5Y2V54q25oCBCiAgICAgIHRoaXMuYmlsbEluZm8ucGF5U3RhdGUgPSB0cnVlOwogICAgICAvL+abtOaWsOiuouWNleS/oeaBr+WSjOWcuuasoeW6p+S9jeS/oeaBrwogICAgICBheGlvcy5kZWZhdWx0cy5oZWFkZXJzLnB1dFsnQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24vanNvbic7CiAgICAgIGNvbnN0IHsKICAgICAgICBkYXRhOiByZXMKICAgICAgfSA9IGF3YWl0IGF4aW9zLnB1dCgnc3lzQmlsbCcsIEpTT04uc3RyaW5naWZ5KHRoaXMuYmlsbEluZm8pKTsKICAgICAgaWYgKHJlcy5jb2RlICE9PSAyMDApIHJldHVybiB0aGlzLiRtZXNzYWdlLmVycm9yKCfmlK/ku5jlpLHotKUnKTsKICAgICAgdGhpcy5wYXlTdGF0ZSA9IHRydWU7CiAgICAgIHRoaXMuJGFsZXJ0KCfmlK/ku5jmiJDlip/vvIHmgqjlj6/ku6XliY3lvoDkuKrkurrkuK3lv4Pmn6XnnIvorqLljZXkv6Hmga8nLCAn5pSv5LuY6YCa55+lJywgewogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAn5oiR55+l6YGT5LqGJywKICAgICAgICBjYWxsYmFjazogYWN0aW9uID0+IHsKICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKCcvYmlsbCcpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgYXN5bmMgY2FuY2VsRm9yQmlsbCgpIHsKICAgICAgLy/mm7TmlrDorqLljZXnirbmgIEKICAgICAgdGhpcy5iaWxsSW5mby5jYW5jZWxTdGF0ZSA9IHRydWU7CiAgICAgIHRoaXMuYmlsbEluZm8uY2FuY2VsVGltZSA9IG1vbWVudChuZXcgRGF0ZSgpKS5mb3JtYXQoJ1lZWVktTU0tREQgSEg6bW06c3MnKTsKICAgICAgLy8g6I635Y+W5Zy65qyh5bqn5L2N5L+h5oGvCiAgICAgIGNvbnN0IHsKICAgICAgICBkYXRhOiBjdXJTZXNzaW9uCiAgICAgIH0gPSBhd2FpdCBheGlvcy5nZXQoJ3N5c1Nlc3Npb24vZmluZC8nICsgdGhpcy5iaWxsSW5mby5zZXNzaW9uSWQpOwogICAgICBsZXQgc2Vzc2lvblNlYXRzID0gSlNPTi5wYXJzZShjdXJTZXNzaW9uLmRhdGEuc2Vzc2lvblNlYXRzKTsKICAgICAgLy8g6Kej5p6Q5Ye66K6i5Y2V6YCJ5oup55qE5bqn5L2N77yM5pu05paw5bqn5L2N5L+h5oGvCiAgICAgIGZvciAobGV0IHNlYXQgb2YgdGhpcy5iaWxsU2VhdHMpIHsKICAgICAgICBsZXQgcm93ID0gc2VhdC5zdWJzdHJpbmcoMCwgc2VhdC5pbmRleE9mKCfmjpInKSk7CiAgICAgICAgbGV0IGNvbCA9IE51bWJlci5wYXJzZUludChzZWF0LnN1YnN0cmluZyhzZWF0LmluZGV4T2YoJ+aOkicpICsgMSwgc2VhdC5sZW5ndGggLSAxKSk7CiAgICAgICAgc2Vzc2lvblNlYXRzW3Jvd11bY29sIC0gMV0gPSAwOwogICAgICB9CiAgICAgIC8vIOabtOaWsOiuouWNleS/oeaBr+WSjOWcuuasoeW6p+S9jeS/oeaBrwogICAgICBheGlvcy5kZWZhdWx0cy5oZWFkZXJzLnB1dFsnQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24vanNvbic7CiAgICAgIGNvbnN0IHsKICAgICAgICBkYXRhOiByZXMKICAgICAgfSA9IGF3YWl0IGF4aW9zLnB1dCgnc3lzQmlsbC9jYW5jZWwnLCBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgc3lzQmlsbDogdGhpcy5iaWxsSW5mbywKICAgICAgICBzZXNzaW9uU2VhdHM6IEpTT04uc3RyaW5naWZ5KHNlc3Npb25TZWF0cykKICAgICAgfSkpOwogICAgICBpZiAocmVzLmNvZGUgIT09IDIwMCkgcmV0dXJuIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+WPlua2iOWksei0pScpOwogICAgICB0aGlzLnBheVN0YXRlID0gZmFsc2U7CiAgICAgIHRoaXMuY2FuY2VsU3RhdGUgPSB0cnVlOwogICAgICB0aGlzLiRhbGVydCgn5Y+W5raI5oiQ5Yqf77yB5oKo5Y+v5Lul5YmN5b6A5Liq5Lq65Lit5b+D5p+l55yL6K6i5Y2V5L+h5oGvJywgJ+WPlua2iOmAmuefpScsIHsKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ+aIkeefpemBk+S6hicsCiAgICAgICAgY2FsbGJhY2s6IGFjdGlvbiA9PiB7CiAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCgnL2JpbGxEZXRhaWwvJyArIHRoaXMuYmlsbEluZm8uYmlsbElkKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGNvbXB1dGVMZWZ0VGltZSgpIHsKICAgICAgbGV0IGN1ciA9IG5ldyBEYXRlKCk7CiAgICAgIGxldCBjcmVhdGVUaW1lID0gbmV3IERhdGUodGhpcy5iaWxsSW5mby5jcmVhdGVUaW1lKTsKICAgICAgbGV0IGRpZmYgPSAxNSAqIDYwIC0gKGN1ciAtIGNyZWF0ZVRpbWUpIC8gMTAwMDsKICAgICAgaWYgKGRpZmYgPCAwKSB7CiAgICAgICAgdGhpcy5taW51dGVzID0gMDsKICAgICAgICB0aGlzLnNlY29uZHMgPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMubWludXRlcyA9IE1hdGguZmxvb3IoZGlmZiAvIDYwKTsKICAgICAgICB0aGlzLnNlY29uZHMgPSBNYXRoLmZsb29yKGRpZmYgJSA2MCk7CiAgICAgIH0KICAgIH0sCiAgICAvL+iuoeaXtui9rOaNouaVsOWtl+agvOW8jwogICAgbnVtOiBmdW5jdGlvbiAobikgewogICAgICByZXR1cm4gbiA8IDEwID8gJzAnICsgbiA6ICcnICsgbjsKICAgIH0sCiAgICAvL+iuoeaXtui1sOWKqAogICAgYWRkOiBmdW5jdGlvbiAoKSB7CiAgICAgIGxldCBfdGhpcyA9IHRoaXM7CiAgICAgIGxldCB0aW1lID0gd2luZG93LnNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoX3RoaXMuc2Vjb25kcyA9PT0gMCAmJiBfdGhpcy5taW51dGVzICE9PSAwKSB7CiAgICAgICAgICBfdGhpcy5zZWNvbmRzID0gNTk7CiAgICAgICAgICBfdGhpcy5taW51dGVzIC09IDE7CiAgICAgICAgfSBlbHNlIGlmIChfdGhpcy5taW51dGVzID09PSAwICYmIF90aGlzLnNlY29uZHMgPT09IDApIHsKICAgICAgICAgIF90aGlzLnNlY29uZHMgPSAwOwogICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwodGltZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIF90aGlzLnNlY29uZHMgLT0gMTsKICAgICAgICB9CiAgICAgIH0sIDEwMDApOwogICAgfQogIH0sCiAgd2F0Y2g6IHsKICAgIHNlY29uZDogewogICAgICBoYW5kbGVyKG5ld1ZhbCkgewogICAgICAgIHRoaXMubnVtKG5ld1ZhbCk7CiAgICAgIH0KICAgIH0sCiAgICBtaW51dGU6IHsKICAgICAgaGFuZGxlcihuZXdWYWwpIHsKICAgICAgICB0aGlzLm51bShuZXdWYWwpOwogICAgICB9CiAgICB9CiAgfSwKICBjb21wdXRlZDogewogICAgc2Vjb25kOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLm51bSh0aGlzLnNlY29uZHMpOwogICAgfSwKICAgIG1pbnV0ZTogZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5udW0odGhpcy5taW51dGVzKTsKICAgIH0KICB9Cn07"},{"version":3,"names":["moment","name","data","billId","$route","params","billInfo","sysSession","sysMovie","sysHall","sysCinema","user","billSeats","payState","cancelState","cancelTime","minutes","seconds","created","getBillInfo","mounted","add","methods","res","axios","get","code","$message","error","userId","JSON","parse","window","sessionStorage","getItem","$alert","confirmButtonText","callback","action","$router","push","console","log","deadline","seats","createTime","computeLeftTime","payForBill","defaults","headers","put","stringify","cancelForBill","Date","format","curSession","sessionId","sessionSeats","seat","row","substring","indexOf","col","Number","parseInt","length","sysBill","cur","diff","Math","floor","num","n","_this","time","setInterval","clearInterval","watch","second","handler","newVal","minute","computed"],"sources":["src/views/pay/BillDetail.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <el-steps :active=\"3\" align-center>\r\n      <el-step title=\"选择影片场次\"></el-step>\r\n      <el-step title=\"选择座位\"></el-step>\r\n      <el-step title=\"15分钟内付款\"></el-step>\r\n      <el-step title=\"影院取票观影\" status=\"wait\"></el-step>\r\n    </el-steps>\r\n    <div class=\"bill-info-container\">\r\n      <!-- 订单状态 -->\r\n      <!-- 未支付，未取消，15分钟内 -->\r\n      <div class=\"bill-info-status\" v-if=\"payState === false && cancelState === false && (minutes > 0 || seconds > 0)\">\r\n        <div class=\"pay-icon\">\r\n          <img src=\"../../assets/money.png\">\r\n        </div>\r\n        <div class=\"pay-info\">\r\n          <div class=\"pay-info-status\">待支付</div>\r\n          <div class=\"pay-info-desc\">请在<span>{{minutes}}分钟{{seconds}}秒</span>内完成支付</div>\r\n        </div>\r\n      </div>\r\n      <!-- 未支付，超时取消，15分钟 -->\r\n      <div class=\"bill-info-status invalid\" v-if=\"payState === false && cancelState === true && cancelTime === null && minutes <= 0 && seconds <= 0\">\r\n        <div class=\"pay-icon\">\r\n          <img src=\"../../assets/bill-invalid.png\">\r\n        </div>\r\n        <div class=\"pay-info\">\r\n          <div class=\"pay-info-status invalid\">由于订单超时未支付，已失效</div>\r\n        </div>\r\n      </div>\r\n      <div class=\"bill-info-status finish\" v-if=\"payState === true\">\r\n        <div class=\"pay-icon\">\r\n          <img src=\"../../assets/finish.png\">\r\n        </div>\r\n        <div class=\"pay-info\">\r\n          <div class=\"pay-info-status finish\">已完成</div>\r\n        </div>\r\n      </div>\r\n      <div class=\"bill-info-status invalid\" v-if=\"cancelState === true && cancelTime !== null\">\r\n        <div class=\"pay-icon\">\r\n          <img src=\"../../assets/bill-invalid.png\">\r\n        </div>\r\n        <div class=\"pay-info\">\r\n          <div class=\"pay-info-status invalid\">订单已取消</div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- 订单信息 -->\r\n      <div class=\"bill-info-desc\">\r\n        <div class=\"bill-info-header\">\r\n          <span>订单编号: {{billInfo.billId}}</span>\r\n          <span class=\"bill-info-helper\">\r\n            (有订单问题可拨打客服电话<div>{{billInfo.sysSession.sysHall.sysCinema.cinemaPhone}}</div>，\r\n            工作时间: {{billInfo.sysSession.sysHall.sysCinema.workStartTime}}-{{billInfo.sysSession.sysHall.sysCinema.workEndTime}})</span>\r\n        </div>\r\n\r\n        <table class=\"order-table\">\r\n          <thead>\r\n          <tr>\r\n            <th>影片</th>\r\n            <th>语言版本</th>\r\n            <th>播放时间</th>\r\n            <th>座位</th>\r\n            <th>提示信息</th>\r\n          </tr>\r\n          </thead>\r\n          <tbody>\r\n          <tr>\r\n            <td class=\"movie-name\">《{{billInfo.sysSession.sysMovie.movieName}}》</td>\r\n            <td class=\"movie-name\">{{billInfo.sysSession.languageVersion}}</td>\r\n            <td class=\"showtime\">{{billInfo.sysSession.sessionDate}} {{billInfo.sysSession.playTime}} - {{billInfo.sysSession.endTime}}</td>\r\n            <td>\r\n              <span class=\"hall\">{{billInfo.sysSession.sysHall.hallName}}</span>\r\n              <div class=\"seats\">\r\n                <span class=\"bill-seat\" v-for=\"item in billSeats\" :key=\"item\"> {{item}} </span>\r\n              </div>\r\n            </td>\r\n            <td>\r\n              <span>{{billInfo.sysSession.sessionTips}}</span>\r\n            </td>\r\n          </tr>\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n      <!-- 影院信息、提交订单 -->\r\n      <div class=\"bill-info-area\">\r\n        <div class=\"cinema-info\">\r\n          <span class=\"bill-cinema-name\">{{billInfo.sysSession.sysHall.sysCinema.cinemaName}}</span>\r\n          <div class=\"bill-cinema-info\">\r\n            <span>地址: {{billInfo.sysSession.sysHall.sysCinema.cinemaAddress}} </span>\r\n            <span>电话: {{billInfo.sysSession.sysHall.sysCinema.cinemaPhone}} </span>\r\n          </div>\r\n        </div>\r\n        <div class=\"submit-bill\">\r\n          <div>总价：<span>{{(billInfo.sysSession.sessionPrice * billSeats.length).toFixed(1)}}</span></div>\r\n          <div v-if=\"payState === false && cancelState === false && (minutes > 0 || seconds > 0)\">\r\n            <el-button @click=\"payForBill\" type=\"primary\" style=\"width: 200px; margin-top: 20px;\" round>立即支付</el-button></div>\r\n          <div v-if=\"payState === false && cancelState === false && (minutes > 0 || seconds > 0)\">\r\n            <el-button @click=\"cancelForBill\" type=\"danger\" style=\"width: 200px; margin-top: 20px;\" round>取消订单</el-button></div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport moment from 'moment'\r\nexport default {\r\n  name: \"BillDetail\",\r\n  data() {\r\n    return {\r\n      billId: this.$route.params.billId,\r\n      billInfo: {\r\n        sysSession: {\r\n          sysMovie: {},\r\n          sysHall: {\r\n            sysCinema: {\r\n              user: {}\r\n            }\r\n          }\r\n        }\r\n      },\r\n      billSeats: [],\r\n      payState: null,\r\n      cancelState: null,\r\n      cancelTime: null,\r\n      //计时\r\n      minutes: 1,\r\n      seconds: 0,\r\n    }\r\n  },\r\n  created() {\r\n    this.getBillInfo()\r\n  },\r\n  mounted() {\r\n    this.add()\r\n  },\r\n  methods: {\r\n    async getBillInfo() {\r\n      const { data : res } = await axios.get('sysBill/' + this.billId)\r\n      if(res.code !== 200) return this.$message.error('获取信息失败')\r\n      let userId = JSON.parse(window.sessionStorage.getItem('loginUser')).userId\r\n      if (userId !== res.data.userId) {\r\n        this.$alert('非法操作！操作非本人订单。', '非法操作订单警告', {\r\n          confirmButtonText: '我知道了',\r\n          callback: action => {\r\n            this.$router.push('/bill')\r\n          }\r\n        })\r\n        return\r\n      }\r\n      this.billInfo = res.data\r\n\r\n      this.cancelTime = this.billInfo.cancelTime\r\n      console.log(this.billInfo)\r\n      // 截止时间\r\n      console.log(this.billInfo.deadline)\r\n      //处理订单座位信息\r\n      this.billSeats = JSON.parse(this.billInfo.seats)\r\n      this.payState = this.billInfo.payState\r\n      this.cancelState = this.billInfo.cancelState\r\n      console.log('the create_time'+this.billInfo.createTime)\r\n      this.computeLeftTime()\r\n    },\r\n    async payForBill() {\r\n      //更新订单状态\r\n      this.billInfo.payState = true\r\n      //更新订单信息和场次座位信息\r\n      axios.defaults.headers.put['Content-Type'] = 'application/json'\r\n      const { data: res} = await axios.put('sysBill', JSON.stringify(this.billInfo))\r\n      if(res.code !== 200) return this.$message.error('支付失败')\r\n      this.payState = true\r\n      this.$alert('支付成功！您可以前往个人中心查看订单信息', '支付通知', {\r\n        confirmButtonText: '我知道了',\r\n        callback: action => {\r\n          this.$router.push('/bill')\r\n        }\r\n      })\r\n    },\r\n    async cancelForBill() {\r\n      //更新订单状态\r\n      this.billInfo.cancelState = true\r\n      this.billInfo.cancelTime = moment(new Date()).format('YYYY-MM-DD HH:mm:ss')\r\n      // 获取场次座位信息\r\n      const { data : curSession } = await axios.get('sysSession/find/' + this.billInfo.sessionId)\r\n      let sessionSeats = JSON.parse(curSession.data.sessionSeats)\r\n      // 解析出订单选择的座位，更新座位信息\r\n      for(let seat of this.billSeats){\r\n        let row = seat.substring(0, seat.indexOf('排'))\r\n        let col = Number.parseInt(seat.substring(seat.indexOf('排') + 1, seat.length - 1))\r\n        sessionSeats[row][col - 1] = 0\r\n      }\r\n      // 更新订单信息和场次座位信息\r\n      axios.defaults.headers.put['Content-Type'] = 'application/json'\r\n      const { data: res } = await axios.put('sysBill/cancel',JSON.stringify({sysBill: this.billInfo, sessionSeats: JSON.stringify(sessionSeats)}))\r\n      if(res.code !== 200) return this.$message.error('取消失败')\r\n\r\n      this.payState = false\r\n      this.cancelState = true\r\n      this.$alert('取消成功！您可以前往个人中心查看订单信息', '取消通知', {\r\n        confirmButtonText: '我知道了',\r\n        callback: action => {\r\n          this.$router.push('/billDetail/' + this.billInfo.billId)\r\n        }\r\n      })\r\n    },\r\n    computeLeftTime() {\r\n      let cur = new Date()\r\n      let createTime = new Date(this.billInfo.createTime)\r\n      let diff = 15 * 60 - (cur - createTime) / 1000\r\n      if (diff < 0) {\r\n        this.minutes = 0\r\n        this.seconds = 0\r\n      } else {\r\n        this.minutes = Math.floor(diff / 60)\r\n        this.seconds = Math.floor(diff % 60)\r\n      }\r\n    },\r\n    //计时转换数字格式\r\n    num: function (n) {\r\n      return n < 10 ? '0' + n : '' + n\r\n    },\r\n    //计时走动\r\n    add: function () {\r\n      let _this = this\r\n      let time = window.setInterval(function () {\r\n        if (_this.seconds === 0 && _this.minutes !== 0) {\r\n          _this.seconds = 59\r\n          _this.minutes -= 1\r\n        } else if (_this.minutes === 0 && _this.seconds === 0) {\r\n          _this.seconds = 0\r\n          window.clearInterval(time)\r\n        } else {\r\n          _this.seconds -= 1\r\n        }\r\n      }, 1000)\r\n    },\r\n  },\r\n  watch: {\r\n    second: {\r\n      handler (newVal) {\r\n        this.num(newVal)\r\n      }\r\n    },\r\n    minute: {\r\n      handler (newVal) {\r\n        this.num(newVal)\r\n      }\r\n    }\r\n  },\r\n  computed: {\r\n    second: function () {\r\n      return this.num(this.seconds)\r\n    },\r\n    minute: function () {\r\n      return this.num(this.minutes)\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.el-step {\r\n  margin: 40px auto;\r\n}\r\n\r\n.bill-info-container{\r\n  width: 80%;\r\n  margin: 0 auto 40px auto;\r\n}\r\n\r\n.bill-info-status{\r\n  height: 120px;\r\n  background: #FFFBF2;\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 40px;\r\n}\r\n\r\n.pay-icon{\r\n  width: 40px;\r\n  height:40px;\r\n  margin-left: 50px;\r\n}\r\n\r\n.pay-icon>img{\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.pay-info{\r\n  display: flex;\r\n  flex-direction: column;\r\n  margin-left: 20px;\r\n}\r\n\r\n.pay-info-status{\r\n  color: #FAAF00;\r\n  font-size: 24px;\r\n  font-weight: 700;\r\n}\r\n\r\n.pay-info-desc{\r\n  color: #999;\r\n  font-size: 13px;\r\n}\r\n\r\n.pay-info-desc>span{\r\n  font-size: 16px;\r\n  color: #faaf00;\r\n  margin: 5px 5px;\r\n}\r\n\r\n.bill-info-status.finish{\r\n  background: #F4FFF8;\r\n}\r\n\r\n.bill-info-status.invalid{\r\n  background: #FFE0E0;\r\n}\r\n\r\n.pay-info-status.finish{\r\n  color: #26CE61;\r\n}\r\n\r\n.pay-info-status.invalid{\r\n  color: #faaaaa;\r\n}\r\n\r\n.bill-info-header{\r\n  display: flex;\r\n  justify-content: space-between;\r\n}\r\n\r\n.bill-info-header>span>div{\r\n  color: #f03d37;\r\n}\r\n\r\n.bill-info-helper{\r\n  color: #999;\r\n  font-size: 13px;\r\n  display: flex;\r\n  margin-bottom: 8px;\r\n}\r\n\r\n.order-table{\r\n  width: 100%;\r\n  border: 1px solid #e5e5e5;\r\n  border-spacing: 0;\r\n  margin-bottom: 60px;\r\n}\r\n\r\n.order-table thead {\r\n  background-color: #f7f7f7;\r\n}\r\n\r\n.order-table thead th {\r\n  font-size: 16px;\r\n  color: #333;\r\n  width: 20%;\r\n  padding: 14px 0;\r\n  font-weight: 400;\r\n}\r\n\r\n.order-table td {\r\n  text-align: center;\r\n  padding: 20px 0;\r\n  color: #333;\r\n}\r\n\r\n.order-table .movie-name {\r\n  font-size: 16px;\r\n}\r\n\r\n.order-table .showtime {\r\n  font-size: 14px;\r\n  color: #f03d37;\r\n}\r\n\r\n.order-table .cinema-name {\r\n  font-size: 14px;\r\n}\r\n\r\n.order-table .hall {\r\n  display: inline-block;\r\n  font-size: 14px;\r\n  color: #424242;\r\n  font-weight: 700;\r\n  margin-right: 10px;\r\n  vertical-align: top;\r\n}\r\n\r\n.order-table .seats {\r\n  display: inline-flex;\r\n  text-align: left;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.order-table .seats span{\r\n  margin-right: 5px;\r\n}\r\n\r\n.bill-info-area{\r\n  display: flex;\r\n  justify-content: space-between;\r\n}\r\n\r\n.bill-cinema-name{\r\n  font-weight: 700;\r\n}\r\n\r\n.bill-cinema-info{\r\n  display: flex;\r\n  flex-direction: column;\r\n  margin-top: 15px;\r\n}\r\n\r\n.submit-bill{\r\n  margin-top: 40px;\r\n}\r\n\r\n.submit-bill span{\r\n  color: #f03d37;\r\n  font-size: 32px;\r\n  font-weight: 700;\r\n}\r\n\r\n.submit-bill span:before{\r\n  content: '￥';\r\n  font-size: 20px;\r\n}\r\n</style>\r\n"],"mappings":";AAyGA,OAAAA,MAAA;AACA;EACAC,IAAA;EACAC,KAAA;IACA;MACAC,MAAA,OAAAC,MAAA,CAAAC,MAAA,CAAAF,MAAA;MACAG,QAAA;QACAC,UAAA;UACAC,QAAA;UACAC,OAAA;YACAC,SAAA;cACAC,IAAA;YACA;UACA;QACA;MACA;MACAC,SAAA;MACAC,QAAA;MACAC,WAAA;MACAC,UAAA;MACA;MACAC,OAAA;MACAC,OAAA;IACA;EACA;EACAC,QAAA;IACA,KAAAC,WAAA;EACA;EACAC,QAAA;IACA,KAAAC,GAAA;EACA;EACAC,OAAA;IACA,MAAAH,YAAA;MACA;QAAAjB,IAAA,EAAAqB;MAAA,UAAAC,KAAA,CAAAC,GAAA,mBAAAtB,MAAA;MACA,IAAAoB,GAAA,CAAAG,IAAA,sBAAAC,QAAA,CAAAC,KAAA;MACA,IAAAC,MAAA,GAAAC,IAAA,CAAAC,KAAA,CAAAC,MAAA,CAAAC,cAAA,CAAAC,OAAA,eAAAL,MAAA;MACA,IAAAA,MAAA,KAAAN,GAAA,CAAArB,IAAA,CAAA2B,MAAA;QACA,KAAAM,MAAA;UACAC,iBAAA;UACAC,QAAA,EAAAC,MAAA;YACA,KAAAC,OAAA,CAAAC,IAAA;UACA;QACA;QACA;MACA;MACA,KAAAlC,QAAA,GAAAiB,GAAA,CAAArB,IAAA;MAEA,KAAAa,UAAA,QAAAT,QAAA,CAAAS,UAAA;MACA0B,OAAA,CAAAC,GAAA,MAAApC,QAAA;MACA;MACAmC,OAAA,CAAAC,GAAA,MAAApC,QAAA,CAAAqC,QAAA;MACA;MACA,KAAA/B,SAAA,GAAAkB,IAAA,CAAAC,KAAA,MAAAzB,QAAA,CAAAsC,KAAA;MACA,KAAA/B,QAAA,QAAAP,QAAA,CAAAO,QAAA;MACA,KAAAC,WAAA,QAAAR,QAAA,CAAAQ,WAAA;MACA2B,OAAA,CAAAC,GAAA,0BAAApC,QAAA,CAAAuC,UAAA;MACA,KAAAC,eAAA;IACA;IACA,MAAAC,WAAA;MACA;MACA,KAAAzC,QAAA,CAAAO,QAAA;MACA;MACAW,KAAA,CAAAwB,QAAA,CAAAC,OAAA,CAAAC,GAAA;MACA;QAAAhD,IAAA,EAAAqB;MAAA,UAAAC,KAAA,CAAA0B,GAAA,YAAApB,IAAA,CAAAqB,SAAA,MAAA7C,QAAA;MACA,IAAAiB,GAAA,CAAAG,IAAA,sBAAAC,QAAA,CAAAC,KAAA;MACA,KAAAf,QAAA;MACA,KAAAsB,MAAA;QACAC,iBAAA;QACAC,QAAA,EAAAC,MAAA;UACA,KAAAC,OAAA,CAAAC,IAAA;QACA;MACA;IACA;IACA,MAAAY,cAAA;MACA;MACA,KAAA9C,QAAA,CAAAQ,WAAA;MACA,KAAAR,QAAA,CAAAS,UAAA,GAAAf,MAAA,KAAAqD,IAAA,IAAAC,MAAA;MACA;MACA;QAAApD,IAAA,EAAAqD;MAAA,UAAA/B,KAAA,CAAAC,GAAA,2BAAAnB,QAAA,CAAAkD,SAAA;MACA,IAAAC,YAAA,GAAA3B,IAAA,CAAAC,KAAA,CAAAwB,UAAA,CAAArD,IAAA,CAAAuD,YAAA;MACA;MACA,SAAAC,IAAA,SAAA9C,SAAA;QACA,IAAA+C,GAAA,GAAAD,IAAA,CAAAE,SAAA,IAAAF,IAAA,CAAAG,OAAA;QACA,IAAAC,GAAA,GAAAC,MAAA,CAAAC,QAAA,CAAAN,IAAA,CAAAE,SAAA,CAAAF,IAAA,CAAAG,OAAA,WAAAH,IAAA,CAAAO,MAAA;QACAR,YAAA,CAAAE,GAAA,EAAAG,GAAA;MACA;MACA;MACAtC,KAAA,CAAAwB,QAAA,CAAAC,OAAA,CAAAC,GAAA;MACA;QAAAhD,IAAA,EAAAqB;MAAA,UAAAC,KAAA,CAAA0B,GAAA,mBAAApB,IAAA,CAAAqB,SAAA;QAAAe,OAAA,OAAA5D,QAAA;QAAAmD,YAAA,EAAA3B,IAAA,CAAAqB,SAAA,CAAAM,YAAA;MAAA;MACA,IAAAlC,GAAA,CAAAG,IAAA,sBAAAC,QAAA,CAAAC,KAAA;MAEA,KAAAf,QAAA;MACA,KAAAC,WAAA;MACA,KAAAqB,MAAA;QACAC,iBAAA;QACAC,QAAA,EAAAC,MAAA;UACA,KAAAC,OAAA,CAAAC,IAAA,uBAAAlC,QAAA,CAAAH,MAAA;QACA;MACA;IACA;IACA2C,gBAAA;MACA,IAAAqB,GAAA,OAAAd,IAAA;MACA,IAAAR,UAAA,OAAAQ,IAAA,MAAA/C,QAAA,CAAAuC,UAAA;MACA,IAAAuB,IAAA,cAAAD,GAAA,GAAAtB,UAAA;MACA,IAAAuB,IAAA;QACA,KAAApD,OAAA;QACA,KAAAC,OAAA;MACA;QACA,KAAAD,OAAA,GAAAqD,IAAA,CAAAC,KAAA,CAAAF,IAAA;QACA,KAAAnD,OAAA,GAAAoD,IAAA,CAAAC,KAAA,CAAAF,IAAA;MACA;IACA;IACA;IACAG,GAAA,WAAAA,CAAAC,CAAA;MACA,OAAAA,CAAA,cAAAA,CAAA,QAAAA,CAAA;IACA;IACA;IACAnD,GAAA,WAAAA,CAAA;MACA,IAAAoD,KAAA;MACA,IAAAC,IAAA,GAAA1C,MAAA,CAAA2C,WAAA;QACA,IAAAF,KAAA,CAAAxD,OAAA,UAAAwD,KAAA,CAAAzD,OAAA;UACAyD,KAAA,CAAAxD,OAAA;UACAwD,KAAA,CAAAzD,OAAA;QACA,WAAAyD,KAAA,CAAAzD,OAAA,UAAAyD,KAAA,CAAAxD,OAAA;UACAwD,KAAA,CAAAxD,OAAA;UACAe,MAAA,CAAA4C,aAAA,CAAAF,IAAA;QACA;UACAD,KAAA,CAAAxD,OAAA;QACA;MACA;IACA;EACA;EACA4D,KAAA;IACAC,MAAA;MACAC,QAAAC,MAAA;QACA,KAAAT,GAAA,CAAAS,MAAA;MACA;IACA;IACAC,MAAA;MACAF,QAAAC,MAAA;QACA,KAAAT,GAAA,CAAAS,MAAA;MACA;IACA;EACA;EACAE,QAAA;IACAJ,MAAA,WAAAA,CAAA;MACA,YAAAP,GAAA,MAAAtD,OAAA;IACA;IACAgE,MAAA,WAAAA,CAAA;MACA,YAAAV,GAAA,MAAAvD,OAAA;IACA;EACA;AACA","ignoreList":[]}]}